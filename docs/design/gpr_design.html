<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Generic Packet Router &mdash; AudioReach Documentation 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/audioreach.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Linux Adaptation Design" href="lx_design.html" />
    <link rel="prev" title="AudioReach Graph Services" href="args_design.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            AudioReach Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../sdk_overview.html">AudioReach Project Overview</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">AudioReach Designs</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="arch_overview.html">AudioReach Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="design_concept.html">AudioReach Concept and Terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="arspf_design.html">AudioReach Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="args_design.html">AudioReach Graph Services</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Generic Packet Router</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#purpose">Purpose</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#functional-overview">Functional Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpr-infrastructure">GPR Infrastructure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-messaging-model">API Messaging Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpr-protocol">GPR Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="#general-operations">General Operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#routing">Routing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#local-routing">Local Routing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#remote-routing">Remote Routing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-infrastructure-interfaces">GPR Infrastructure Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpr-constants-and-macros">GPR Constants and Macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-documentation">Define Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-status-and-error-codes">GPR Status and Error Codes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id6">Define Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-core-packet-structure">GPR Core Packet Structure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#data-structure-documentation">Data Structure Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#callback-function-prototype">Callback Function Prototype</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#typedef-documentation">Typedef Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-core-routines">GPR Core Routines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-documentation">Function Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-fundamental-controls">GPR Fundamental Controls</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#register-a-service">Register a Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deregister-a-service">Deregister a Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-for-registered-service">Query for Registered Service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-for-local-or-host-domain">Query for Local or Host Domain</a></li>
<li class="toctree-l4"><a class="reference internal" href="#query-for-packet-pool-information">Query for Packet Pool Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send-an-asynchronous-message">Send an Asynchronous Message</a></li>
<li class="toctree-l4"><a class="reference internal" href="#allocate-a-free-message-for-delivery">Allocate a Free Message for Delivery</a></li>
<li class="toctree-l4"><a class="reference internal" href="#free-a-packet-from-a-queue">Free a Packet from a Queue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gpr-utility-controls">GPR Utility Controls</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#allocate-part-of-a-message">Allocate Part of a Message</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#allocate-and-send-a-message">Allocate and Send a Message</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id16">Function Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#accept-a-command-message">Accept a Command Message</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id17">Function Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#send-a-command-response">Send a Command Response</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id18">Function Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpr-standard-response-opcodes">GPR Standard Response Opcodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ipc-interfaces">IPC Interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpr-to-ipc-callback-functions">GPR-to-IPC Callback Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipc-to-gpr-virtual-function-wrapper">IPC-to-GPR Virtual Function Wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ipc-data-link-function-prototypes">IPC Data Link Function Prototypes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gpr-functions-for-local-routing">GPR Functions for Local Routing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#platform-specific-configuration-wrappers">Platform-specific Configuration Wrappers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#custom-implementations">Custom Implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-platform-wrapper">Custom Platform Wrapper</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-domain-id">Custom Domain ID</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-ipc-data-link-or-transport-layer">Custom IPC Data Link or Transport Layer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#acronyms-and-terms">Acronyms and Terms</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lx_design.html">Linux Adaptation Design</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">AudioReach APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">AudioReach Developer Guides</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AudioReach Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">AudioReach Designs</a></li>
      <li class="breadcrumb-item active">Generic Packet Router</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/design/gpr_design.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="generic-packet-router">
<span id="gpr-design"></span><h1>Generic Packet Router<a class="headerlink" href="#generic-packet-router" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id37">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#purpose" id="id38">Purpose</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#functional-overview" id="id39">Functional Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#gpr-infrastructure" id="id40">GPR Infrastructure</a></p></li>
<li><p><a class="reference internal" href="#api-messaging-model" id="id41">API Messaging Model</a></p></li>
<li><p><a class="reference internal" href="#gpr-protocol" id="id42">GPR Protocol</a></p></li>
<li><p><a class="reference internal" href="#general-operations" id="id43">General Operations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#routing" id="id44">Routing</a></p>
<ul>
<li><p><a class="reference internal" href="#local-routing" id="id45">Local Routing</a></p></li>
<li><p><a class="reference internal" href="#remote-routing" id="id46">Remote Routing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-infrastructure-interfaces" id="id47">GPR Infrastructure Interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#gpr-constants-and-macros" id="id48">GPR Constants and Macros</a></p></li>
<li><p><a class="reference internal" href="#define-documentation" id="id49">Define Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-status-and-error-codes" id="id50">GPR Status and Error Codes</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id51">Define Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-core-packet-structure" id="id52">GPR Core Packet Structure</a></p>
<ul>
<li><p><a class="reference internal" href="#data-structure-documentation" id="id53">Data Structure Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#callback-function-prototype" id="id54">Callback Function Prototype</a></p>
<ul>
<li><p><a class="reference internal" href="#typedef-documentation" id="id55">Typedef Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-core-routines" id="id56">GPR Core Routines</a></p>
<ul>
<li><p><a class="reference internal" href="#function-documentation" id="id57">Function Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-fundamental-controls" id="id58">GPR Fundamental Controls</a></p>
<ul>
<li><p><a class="reference internal" href="#register-a-service" id="id59">Register a Service</a></p></li>
<li><p><a class="reference internal" href="#deregister-a-service" id="id60">Deregister a Service</a></p></li>
<li><p><a class="reference internal" href="#query-for-registered-service" id="id61">Query for Registered Service</a></p></li>
<li><p><a class="reference internal" href="#query-for-local-or-host-domain" id="id62">Query for Local or Host Domain</a></p></li>
<li><p><a class="reference internal" href="#query-for-packet-pool-information" id="id63">Query for Packet Pool Information</a></p></li>
<li><p><a class="reference internal" href="#send-an-asynchronous-message" id="id64">Send an Asynchronous Message</a></p></li>
<li><p><a class="reference internal" href="#allocate-a-free-message-for-delivery" id="id65">Allocate a Free Message for Delivery</a></p></li>
<li><p><a class="reference internal" href="#free-a-packet-from-a-queue" id="id66">Free a Packet from a Queue</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#gpr-utility-controls" id="id67">GPR Utility Controls</a></p>
<ul>
<li><p><a class="reference internal" href="#allocate-part-of-a-message" id="id68">Allocate Part of a Message</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#allocate-and-send-a-message" id="id69">Allocate and Send a Message</a></p>
<ul>
<li><p><a class="reference internal" href="#id16" id="id70">Function Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#accept-a-command-message" id="id71">Accept a Command Message</a></p>
<ul>
<li><p><a class="reference internal" href="#id17" id="id72">Function Documentation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#send-a-command-response" id="id73">Send a Command Response</a></p>
<ul>
<li><p><a class="reference internal" href="#id18" id="id74">Function Documentation</a></p></li>
<li><p><a class="reference internal" href="#gpr-standard-response-opcodes" id="id75">GPR Standard Response Opcodes</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ipc-interfaces" id="id76">IPC Interfaces</a></p>
<ul>
<li><p><a class="reference internal" href="#gpr-to-ipc-callback-functions" id="id77">GPR-to-IPC Callback Functions</a></p></li>
<li><p><a class="reference internal" href="#ipc-to-gpr-virtual-function-wrapper" id="id78">IPC-to-GPR Virtual Function Wrapper</a></p></li>
<li><p><a class="reference internal" href="#ipc-data-link-function-prototypes" id="id79">IPC Data Link Function Prototypes</a></p></li>
<li><p><a class="reference internal" href="#gpr-functions-for-local-routing" id="id80">GPR Functions for Local Routing</a></p></li>
<li><p><a class="reference internal" href="#platform-specific-configuration-wrappers" id="id81">Platform-specific Configuration Wrappers</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#custom-implementations" id="id82">Custom Implementations</a></p>
<ul>
<li><p><a class="reference internal" href="#custom-platform-wrapper" id="id83">Custom Platform Wrapper</a></p></li>
<li><p><a class="reference internal" href="#custom-domain-id" id="id84">Custom Domain ID</a></p></li>
<li><p><a class="reference internal" href="#custom-ipc-data-link-or-transport-layer" id="id85">Custom IPC Data Link or Transport Layer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#acronyms-and-terms" id="id86">Acronyms and Terms</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id37" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h2>
<section id="purpose">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Purpose</a><a class="headerlink" href="#purpose" title="Permalink to this heading"></a></h3>
<p>This document describes the Generic Packet Router (GPR) API, which
is intended to help developers understand and use the GPR to access
or publish new services. Readers are assumed to be developers with
some familiarity in packet-based and message-based protocols.
This document provides the public interfaces necessary to use the
features provided by the GPR API. A functional overview and
information on leveraging the interface functionality are also
provided.</p>
</section>
</section>
<section id="functional-overview">
<span id="gpr-overview"></span><h2><a class="toc-backref" href="#id39" role="doc-backlink">Functional Overview</a><a class="headerlink" href="#functional-overview" title="Permalink to this heading"></a></h2>
<p>This chapter provides an overview of the GPR infrastructure and
protocol.</p>
<section id="gpr-infrastructure">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">GPR Infrastructure</a><a class="headerlink" href="#gpr-infrastructure" title="Permalink to this heading"></a></h3>
<p>The GPR infrastructure provides a common set of APIs across
different platforms, software layers, and processor domains to
enable them to communicate using asynchronous messages. The
infrastructure is a memory optimized, platform agnostic layer.
The following figure illustrates an example of the GPR
infrastructure on different processor domains such as the
Application domain, DSP domain, and so on. The GPR can also be used
on different platforms such as the Arm processor and Windows
operating system. Refer to  <a class="reference external" href="#id30">GPR infrastructure on different processing domains</a></p>
<figure class="fig-center align-default" id="id30">
<a class="reference internal image-reference" href="../_images/Image18.png"><img alt="../_images/Image18.png" src="../_images/Image18.png" style="width: 4.75583in; height: 4.38083in;" /></a>
<figcaption>
<p><span class="caption-text">GPR infrastructure on different processing domains</span><a class="headerlink" href="#id30" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The AudioReach Engine (ARE) provides the necessary
framework to realize audio and voice use cases with various
algorithm and framework modules (see <a class="reference internal" href="arspf_design.html#arspf-design"><span class="std std-ref">AudioReach Engine</span></a>). The
Graph Service Layer (GSL) serves as the client and interacts with
the ARE to provide use case configuration and calibration.
The GPR is responsible for routing messages and commands between the
ARE and GSL processing domains in the AudioReach framework. It
achieves this remote communication by abstracting out the underlying
Interprocessor communication (IPC) data link layers. Essentially,
the GPR does two types of routing:</p>
<ul class="simple">
<li><p>Local routing – Communication within the same processor domain.</p></li>
<li><p>Remote routing – Communication between different processor domains.
The GPR interfaces with the data link layer to achieve this remote
routing.</p></li>
</ul>
<section id="gpr-software-layering">
<h4>GPR Software Layering<a class="headerlink" href="#gpr-software-layering" title="Permalink to this heading"></a></h4>
<p>The GPR infrastructure is categorized into three layers: core layer,
data link layer, and platform layer. Below figure
illustrates this simplified model.</p>
<figure class="fig-center align-default" id="id31">
<span id="gpr-layering-model"></span><a class="reference internal image-reference" href="../_images/Image26.png"><img alt="../_images/Image26.png" src="../_images/Image26.png" style="width: 6.50917in; height: 4.13583in;" /></a>
<figcaption>
<p><span class="caption-text">GPR layering model</span><a class="headerlink" href="#id31" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="core-layer">
<h4>Core Layer<a class="headerlink" href="#core-layer" title="Permalink to this heading"></a></h4>
<p>The core layer implements the core GPR functionality and can be
further classified into the following functional blocks.</p>
<ul class="simple">
<li><p>Client interface</p>
<ul>
<li><p>Implements the core GPR APIs such as send packets, allocate
packets, and so on that are used by all clients.</p></li>
</ul>
</li>
<li><p>Packet routing layer</p>
<ul>
<li><p>Implements the GPR packet queues.</p></li>
<li><p>Is responsible for local routing, which refers to packets that are
transmitted within the same processor domain.</p></li>
</ul>
</li>
<li><p>Data link interface</p>
<ul>
<li><p>Is the GPR’s interface with the data link layer.</p></li>
<li><p>Implements the GPR callback functions that are shared with every
data link layer.</p></li>
<li><p>Functions are called <em>GPR-to-IPC</em> callback functions and are
essential to enable remote routing (see Section
<a class="reference internal" href="#gpr-to-ipc-callback-functions"><span class="std std-ref">GPR-to-IPC Callback Functions</span></a>).</p></li>
</ul>
</li>
</ul>
</section>
<section id="data-link-layer">
<h4>Data Link Layer<a class="headerlink" href="#data-link-layer" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>The GPR data link layer is responsible for remote routing, which is
the routing between different processor domains. Every data link
implementation has two parts:</p>
</div></blockquote>
<ul>
<li><p>Core data link layer</p>
<ul class="simple">
<li><p>Contains the actual implementation of the data link transport
layer APIs and functionality that facilitates remote routing.</p></li>
<li><p>Examples of data link layers include the Generic Link (G-link)
and the Shared Memory Driver (SMD).</p></li>
</ul>
</li>
<li><p>GPR data link plug-in</p>
<ul class="simple">
<li><p>Wrapper to the core data link layer.</p></li>
<li><p>Implements the IPC-to-GPR callback functions (see Section
<a class="reference internal" href="#ipc-to-gpr-virtual-function-wrapper"><span class="std std-ref">IPC-to-GPR Virtual Function Wrapper</span></a>) that are shared
with the GPR data link interface during initialization.</p></li>
</ul>
<blockquote>
<div><p>Each domain can support multiple data link or transport mechanisms.
As illustrated by <a class="reference external" href="#_gpr_layering_model">Fig: GPR layering model</a>, any custom data link
implementation can be plugged in to the GPR. As long as both
processor domains implement the same data link layer, they can
establish communication through it. At any time, the GPR supports
only one data link between two given process domains.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="platform-layer">
<h4>Platform layer<a class="headerlink" href="#platform-layer" title="Permalink to this heading"></a></h4>
<p>The platform layer comprises all the platform
specific-implementations and enables the GPR to be platform
agnostic. It has two components:</p>
<ul class="simple">
<li><p>Platform-specific configuration wrappers</p>
<ul>
<li><p>Enable each platform to instantiate the GPR with platform-specific
configuration (see Section
<a class="reference internal" href="#platform-specific-configuration-wrappers"><span class="std std-ref">Platform-specific Configuration Wrappers</span></a>).</p></li>
</ul>
</li>
<li><p>Common Operating System Abstraction Layer (OSAL)</p>
<ul>
<li><p>GPR core layer uses this layer as well as the GPR data link
plug-in layers.</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="api-messaging-model">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">API Messaging Model</a><a class="headerlink" href="#api-messaging-model" title="Permalink to this heading"></a></h3>
<section id="asynchronous-messaging-design">
<h4>Asynchronous Messaging Design<a class="headerlink" href="#asynchronous-messaging-design" title="Permalink to this heading"></a></h4>
<p>The GPR infrastructure follows an asynchronous messaging design that
can deliver unidirectional messages quickly and support messaging in
the interrupt context.</p>
</section>
<section id="message-structure">
<h4>Message Structure<a class="headerlink" href="#message-structure" title="Permalink to this heading"></a></h4>
<p>The GPR infrastructure defines the GPR message send function, the
message receive callback function, and the message structure. The
current GPR protocol uses 4-byte aligned, little-endian messages.
Any unrecognized messages will cause the GPR send message function
to return an error. The sender is expected to free undelivered
messages and gracefully handle return errors.
<strong>NOTE:</strong> Messages and packets are used interchangeably in the GPR
infrastructure.</p>
</section>
</section>
<section id="gpr-protocol">
<h3><a class="toc-backref" href="#id42" role="doc-backlink">GPR Protocol</a><a class="headerlink" href="#gpr-protocol" title="Permalink to this heading"></a></h3>
<p>The GPR protocol is a core messaging protocol that runs on top of
the GPR infrastructure and includes the following features:</p>
<ul class="simple">
<li><p>Provides a standard, real-time capable messaging protocol between
client applications and software layers.</p></li>
<li><p>Is a lightweight layer that has minimum protocol overhead.</p></li>
<li><p>Is platform-agnostic.</p></li>
<li><p>Requires the underlying data and transport layers to guarantee serial
delivery.</p></li>
<li><p>Assumes that clients and subsystems will recover from undelivered or
late transactions.</p></li>
</ul>
<section id="packet-details">
<span id="id1"></span><h4>Packet Details<a class="headerlink" href="#packet-details" title="Permalink to this heading"></a></h4>
<p>Below figure illustrates the GPR message/packet
structure (<a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a>), where the
numbers at the top indicate the bit positions. The following
sections provide more details.</p>
<figure class="fig-center align-default" id="id32">
<a class="reference internal image-reference" href="../_images/Image32.png"><img alt="../_images/Image32.png" src="../_images/Image32.png" style="width: 6.17000in; height: 3.12583in;" /></a>
<figcaption>
<p><span class="caption-text">GPR packet data structure with all fields</span><a class="headerlink" href="#id32" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="size-and-version-fields">
<h4>Size and Version Fields<a class="headerlink" href="#size-and-version-fields" title="Permalink to this heading"></a></h4>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image41.png"><img alt="../_images/Image41.png" src="../_images/Image41.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
<p>The following table shows the information for these fields.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Subfield</strong></p></th>
<th class="head"><p><strong>Number of bits</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Version</p></td>
<td><p>4</p></td>
<td><p>Defines the layout of the packet structure.</p>
<p>Unless otherwise indicated, packet versions are assumed to be backward-compatible to the core format (first five header words).</p>
</td>
</tr>
<tr class="row-odd"><td><p>Header Size</p></td>
<td><p>4</p></td>
<td><p>Number of 32-bit header words starting from the beginning of</p>
<p>the packet.</p>
</td>
</tr>
<tr class="row-even"><td><p>Packet Size</p></td>
<td><p>24</p></td>
<td><p>Total packet size in bytes, including both the header and</p>
<p>payload data.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="source-and-destination-domain-fields">
<span id="id2"></span><h4>Source and Destination Domain Fields<a class="headerlink" href="#source-and-destination-domain-fields" title="Permalink to this heading"></a></h4>
<p>The GPR messaging protocol uses a domain ID to define the host
process, processor, or target, and it uses a service ID to define
the services or modules that live within the host.
Every domain must have a dedicated local GPR instance. All messages
must flow through their local GPR instances. The GPR dispatches
messages locally or remotely according to each message’s destination
domain value.
Below figure illustrates two domains, each with its
own GPR instance.</p>
<figure class="fig-center align-default" id="id33">
<a class="reference internal image-reference" href="../_images/Image5.png"><img alt="../_images/Image5.png" src="../_images/Image5.png" style="width: 3.49750in; height: 3.24750in;" /></a>
<figcaption>
<p><span class="caption-text">Example of interprocess communication</span><a class="headerlink" href="#id33" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The following figure illustrates the destination domain field, which
represents a processor or off-target location that contains the GPR
to which the packet is sent.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image61.png"><img alt="../_images/Image61.png" src="../_images/Image61.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
<p>The following figure illustrates the source domain field, which
represents a processor or off-target location that contains the GPR
from which the packet is sent.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image71.png"><img alt="../_images/Image71.png" src="../_images/Image71.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="client-data-field">
<h4>Client Data Field<a class="headerlink" href="#client-data-field" title="Permalink to this heading"></a></h4>
<p>The client data field is used for client-specific needs. By default,
this field must be set to 0 when unused.
The following figure illustrates the field, in which 4 bits are open
for use by the client and 4 bits are reserved and are set to 0.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image81.png"><img alt="../_images/Image81.png" src="../_images/Image81.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="reserved-field">
<h4>Reserved Field<a class="headerlink" href="#reserved-field" title="Permalink to this heading"></a></h4>
<p>The reserved field must always be set to 0.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image91.png"><img alt="../_images/Image91.png" src="../_images/Image91.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="source-and-destination-port-fields">
<span id="id3"></span><h4>Source and Destination Port Fields<a class="headerlink" href="#source-and-destination-port-fields" title="Permalink to this heading"></a></h4>
<p>The source port field represents a unique (within a given domain) ID
that can be used to identify a service or module in the source
domain. It is interpreted as the service ID of the source service or
module instance.
<strong>NOTE:</strong> The terms <em>port</em> and <em>service ID</em> can be used
interchangeably.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image101.png"><img alt="../_images/Image101.png" src="../_images/Image101.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
<p>The destination port field represents the unique (within a domain)
ID that can be used to identify a service or module in the
destination domain. It is interpreted as the service ID of the
destination service or the module instance ID of the destination
module.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image111.png"><img alt="../_images/Image111.png" src="../_images/Image111.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="token-field">
<h4>Token Field<a class="headerlink" href="#token-field" title="Permalink to this heading"></a></h4>
<p>The token field no subfields. It is a transaction identifier, a
sequence number, or any value that allows a client to identify which
command is completed after receiving a command response message. The
token field must be set to 0 when unused.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image121.png"><img alt="../_images/Image121.png" src="../_images/Image121.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="opcode-field">
<span id="id4"></span><h4>Opcode Field<a class="headerlink" href="#opcode-field" title="Permalink to this heading"></a></h4>
<p>The opcode is a GUID value that is used when selecting the operation
and defining the payload structure. The operation selects the
function call, and the payload contains the function arguments.</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image131.png"><img alt="../_images/Image131.png" src="../_images/Image131.png" style="width: 6.13667in; height: 0.62500in;" /></a>
</figure>
</section>
<section id="payload-field">
<h4>Payload Field<a class="headerlink" href="#payload-field" title="Permalink to this heading"></a></h4>
<p>The payload field has no subfields. It contains the arguments to the
function call specified in the opcode field (defined in section
<a class="reference internal" href="#opcode-field"><span class="std std-ref">Opcode Field</span></a>).</p>
<figure class="fig-center align-default">
<a class="reference internal image-reference" href="../_images/Image141.png"><img alt="../_images/Image141.png" src="../_images/Image141.png" style="width: 6.15833in; height: 0.87500in;" /></a>
</figure>
</section>
</section>
<section id="general-operations">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">General Operations</a><a class="headerlink" href="#general-operations" title="Permalink to this heading"></a></h3>
<section id="addressing-scheme">
<h4>Addressing Scheme<a class="headerlink" href="#addressing-scheme" title="Permalink to this heading"></a></h4>
<p>The source or destination for a given GPR packet is identified by a
32-bit service ID (see section
<a class="reference internal" href="#source-and-destination-port-fields"><span class="std std-ref">Source and Destination Port Fields</span></a>) and the 8-bit
processor domain to which the service belongs (see Section
<a class="reference internal" href="#packet-details"><span class="std std-ref">Packet Details</span></a>).
For a given service, the service ID must be unique within the
domain. All services within a domain have the same domain ID.</p>
</section>
<section id="registration">
<h4>Registration<a class="headerlink" href="#registration" title="Permalink to this heading"></a></h4>
<p>To send or receive packets, each service or module must first
register with the GPR. Registration can be done at any time by
calling the
<a class="reference external" href="#static-uint32-t-gpr-cmd-register-uint32-t-src-port-gpr-callback-fn-t-void-callback-data">gpr_cmd_register()</a>
function to register the packet callback function of the service.
Each instance of the GPR maintains a database that stores this
service ID information along with the corresponding callback
function and callback argument (if non-NULL) upon registration.
Every time a new service registers, an entry is added to the
database.
All entries in the database can be identified by their unique
service IDs.</p>
</section>
<section id="deregistration">
<h4>Deregistration<a class="headerlink" href="#deregistration" title="Permalink to this heading"></a></h4>
<p>During a power-down sequence, services or modules must deregister
from the GPR by calling
<a class="reference external" href="#static-uint32-t-gpr-cmd-deregister-uint32-t-src-port">gpr_cmd_deregister()</a>.
Each registered service ID is to be deregistered only once.</p>
</section>
<section id="send-messages">
<h4>Send Messages<a class="headerlink" href="#send-messages" title="Permalink to this heading"></a></h4>
<p>Services or modules use
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>
to send messages in the form of packets through the GPR service.
Callers must check the return result of
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>
for failures, free the packet when the send function fails, and,
when necessary, perform error recovery.
The low-level
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>
function leaves packet allocation and error management to the
caller. Utility APIs are available to make working with
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>
easier. These functions are not mandatory. The caller can use any
utility library to help with packet allocation and error management.</p>
</section>
<section id="receive-messages">
<h4>Receive Messages<a class="headerlink" href="#receive-messages" title="Permalink to this heading"></a></h4>
<p>Services can start receiving messages immediately after registering
with the GPR service. The registered packet callback routine is
assumed to run in the ISR context. All the restrictions in the ISR
context apply to the packet callback routine.
Messages serviced in the ISR context have the highest priority
possible. Any time-consuming operations must be queued to the thread
context for further processing in the appropriate thread priority
level.
You cannot call blocking routines in the dispatch context. Blocking
will cause system instability and performance problems.</p>
</section>
</section>
</section>
<section id="routing">
<h2><a class="toc-backref" href="#id44" role="doc-backlink">Routing</a><a class="headerlink" href="#routing" title="Permalink to this heading"></a></h2>
<p>Routing refers to the GPR’s ability to send and receive data packets
to and from clients or other GPR instances. Depending on the source
and destination domain IDs, the GPR must do either local or remote
routing.
Below figure illustrates the difference between
local and remote routing, which is explained in the following
sections.</p>
<figure class="fig-center align-default" id="id34">
<a class="reference internal image-reference" href="../_images/Image151.png"><img alt="../_images/Image151.png" src="../_images/Image151.png" style="width: 5.88083in; height: 3.50833in;" /></a>
<figcaption>
<p><span class="caption-text">Local and remote routing through GPR</span><a class="headerlink" href="#id34" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="local-routing">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Local Routing</a><a class="headerlink" href="#local-routing" title="Permalink to this heading"></a></h3>
<p>Local routing refers to the transmission of packets within the same
domain.
The GPR determines a given routing to be local if the source domain
ID and destination domain ID are the same. In this case, the GPR
simply searches its database to retrieve the callback function based
on the unique destination service ID. After the callback function is
retrieved, the destination service’s callback routine is invoked and
the packet is sent.
Below figure illustrates the call flow between two
service on the same domain. Both services must first register their
callback functions with the GPR, and then they can exchange
messages.</p>
<figure class="fig-center align-default" id="id35">
<a class="reference internal image-reference" href="../_images/Image161.png"><img alt="../_images/Image161.png" src="../_images/Image161.png" style="width: 5.37396in; height: 4.83437in;" /></a>
<figcaption>
<p><span class="caption-text">Local routing call flow between two services on same domain</span><a class="headerlink" href="#id35" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="remote-routing">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">Remote Routing</a><a class="headerlink" href="#remote-routing" title="Permalink to this heading"></a></h3>
<p>Remote routing refers to the transmission of packets between
different domains or processors. The GPR and IPC data link layers
interact and exchange GPR-IPC callback functions during
initialization (see Sections
<a class="reference internal" href="#gpr-to-ipc-callback-functions"><span class="std std-ref">GPR-to-IPC Callback Functions</span></a> and
<a class="reference internal" href="#ipc-to-gpr-virtual-function-wrapper"><span class="std std-ref">IPC-to-GPR Virtual Function Wrapper</span></a>.) These callback
functions are then invoked at runtime to enable remote routing.
<a class="reference external" href="#_remote_routing_call_flow">Fig: Remote routing call flow</a> below illustrates the call flow for remote
routing. Services on each domain must register with their respective
GPR instances.
Following is the process for sending packets to remote processors:</p>
<ol class="arabic">
<li><p>The GPR allocates a packet and calls the data link layer’s send()
function, which is stored in the
<a class="reference external" href="#struct-ipc-to-gpr-vtbl-t">ipc_to_gpr_vtbl_t</a> virtual
function table (vtable).</p>
<blockquote>
<div><p>This vtable invokes the data link layer to send the packet.</p>
</div></blockquote>
</li>
<li><p>After the data link layer finishes transmitting the packet, it calls
the GPR’s send_done() function, which is stored in the
<a class="reference external" href="#struct-gpr-to-ipc-vtbl-t">gpr_to_ipc_vtbl_t</a> virtual
function table.</p>
<blockquote>
<div><p>This vtable invokes the GPR’s free() function to free the GPR
packet.</p>
</div></blockquote>
</li>
</ol>
<p>Following is the process for remote processors to receive packets:</p>
<ol class="arabic simple">
<li><p>The data link layer copies the contents of the remote GPR packet into
one of its packets.</p></li>
<li><p>Then it calls the GPR’s receive() function, which is stored in the
<a class="reference external" href="#struct-gpr-to-ipc-vtbl-t">gpr_to_ipc_vtbl_t</a> virtual
function table.
This vtable invokes the GPR’s receive() function to transmit the
packet to its destination.</p></li>
<li><p>After the GPR finishes transmitting the packet, it calls the data
link layer’s receive_done() function, which is stored in
<a class="reference external" href="#struct-ipc-to-gpr-vtbl-t">ipc_to_gpr_vtbl_t</a>.
This vtable invokes the data link layer’s free() function to free
the packet.</p></li>
</ol>
<figure class="fig-center align-default" id="id36">
<span id="remote-routing-call-flow"></span><a class="reference internal image-reference" href="../_images/Image171.png"><img alt="../_images/Image171.png" src="../_images/Image171.png" style="width: 6.65792in; height: 8.45229in;" /></a>
<figcaption>
<p><span class="caption-text">Remote routing call flow between GPR and IPC data link layer</span><a class="headerlink" href="#id36" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="gpr-infrastructure-interfaces">
<h2><a class="toc-backref" href="#id47" role="doc-backlink">GPR Infrastructure Interfaces</a><a class="headerlink" href="#gpr-infrastructure-interfaces" title="Permalink to this heading"></a></h2>
<section id="gpr-constants-and-macros">
<span id="gpr-contants-and-macros"></span><h3><a class="toc-backref" href="#id48" role="doc-backlink">GPR Constants and Macros</a><a class="headerlink" href="#gpr-constants-and-macros" title="Permalink to this heading"></a></h3>
<p><strong>GPR Core Export Macros</strong></p>
<ul class="simple">
<li><p>#define <a class="reference external" href="#define-gpr-internal-extern-c">GPR_INTERNAL</a> extern “C”</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-external-extern-c">GPR_EXTERNAL</a> extern “C”</p></li>
</ul>
<p><strong>GPR Domain IDs</strong></p>
<p>A domain ID is to a unique ID that identifies a process, a
processor, or an off-target location that houses GPR. The transport
mechanism between the published domains can vary.
Domain IDs are directly used as port indices to access GPR routing
arrays. Hence they have to always have values starting from 0 such
as 0,1,2,3 and not Globally Unique IDs (GUIDS).</p>
<ul class="simple">
<li><p>#define <a class="reference external" href="#define-gpr-ids-domain-id-invalid-v-0">GPR_IDS_DOMAIN_ID_INVALID_V</a> 0</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ids-domain-id-modem-v-1">GPR_IDS_DOMAIN_ID_MODEM_V</a>
1</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ids-domain-id-adsp-v-2">GPR_IDS_DOMAIN_ID_ADSP_V</a>
2</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-ids-domain-id-apps-v-3">GPR_IDS_DOMAIN_ID_APPS_V</a> 3</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ids-domain-id-sdsp-v-4">GPR_IDS_DOMAIN_ID_SDSP_V</a>
4</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ids-domain-id-cdsp-v-5">GPR_IDS_DOMAIN_ID_CDSP_V</a>
5</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pl-max-domain-id-v">GPR_PL_MAX_DOMAIN_ID_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pl-num-total-domains-v">GPR_PL_NUM_TOTAL_DOMAINS_V</a></p></li>
</ul>
<p><strong>GPR Packet Definitions</strong></p>
<ul class="simple">
<li><p>#define <a class="reference external" href="#define-gpr-pkt-version-v">GPR_PKT_VERSION_V</a></p></li>
<li><p>#define <a class="reference external" href="#define-gpr-pkt-init-port-v">GPR_PKT_INIT_PORT_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-init-reserved-v">GPR_PKT_INIT_RESERVED_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-init-domain-id-v">GPR_PKT_INIT_DOMAIN_ID_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-header-word-size-v">GPR_PKT_HEADER_WORD_SIZE_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-header-byte-size-v">GPR_PKT_HEADER_BYTE_SIZE_V</a></p></li>
<li><p>#define <a class="reference external" href="#define-gpr-undefined-id-v">GPR_UNDEFINED_ID_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ids-domain-id-apps-v-3">GPR_PKT_INIT_CLIENT_DATA_V</a></p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-version-mask-0x0000000f">GPR_PKT_VERSION_MASK</a>
( 0x0000000F )</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-pkt-version-shft-0">GPR_PKT_VERSION_SHFT</a>
( 0 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-header-size-mask-0x000000f0">GPR_PKT_HEADER_SIZE_MASK</a>
( 0x000000F0 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-header-size-shft-4">GPR_PKT_HEADER_SIZE_SHFT</a>
( 4 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-reserved-mask-0xfff00000">GPR_PKT_RESERVED_MASK</a>
( 0xFFF00000 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-init-client-data-v">GPR_PKT_RESERVED_SHFT</a> (
20 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-packet-size-mask-0xffffff00">GPR_PKT_PACKET_SIZE_MASK</a>
( 0xFFFFFF00 )</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-packet-size-shft-8">GPR_PKT_PACKET_SIZE_SHFT</a>
( 8 )</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-get-bitmask-mask-shift-value">GPR_GET_BITMASK</a>(mask, shift, value)</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-set-bitmask-mask-shift-value">GPR_SET_BITMASK</a>(mask, shift, value)</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-get-field-field-value">GPR_GET_FIELD</a>(field, value)</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-init-client-data-v">GPR_SET_FIELD</a>(field,
value)</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-ptr-end-of-base-ptr-offset">GPR_PTR_END_OF</a>(base_ptr, offset)</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-get-packet-byte-size-header">GPR_PKT_GET_PACKET_BYTE_SIZE</a>(header)</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-ptr-end-of-base-ptr-offset">GPR_PKT_GET_HEADER_BYTE_SIZE</a>(header)</p></li>
<li><p>#define
<a class="reference external" href="#define-gpr-pkt-get-payload-byte-size-header">GPR_PKT_GET_PAYLOAD_BYTE_SIZE</a>(header)</p></li>
<li><p>#define <a class="reference external" href="#define-gpr-pkt-get-payload-type-packet-ptr">GPR_PKT_GET_PAYLOAD</a>(type,
packet_ptr)</p></li>
</ul>
</section>
<section id="define-documentation">
<h3><a class="toc-backref" href="#id49" role="doc-backlink">Define Documentation</a><a class="headerlink" href="#define-documentation" title="Permalink to this heading"></a></h3>
<section id="define-gpr-internal-extern-c">
<h4>#define GPR_INTERNAL extern “C”<a class="headerlink" href="#define-gpr-internal-extern-c" title="Permalink to this heading"></a></h4>
<p>Export macro that indicates a function is internal to the GPR.</p>
</section>
<section id="define-gpr-external-extern-c">
<h4>#define GPR_EXTERNAL extern “C”<a class="headerlink" href="#define-gpr-external-extern-c" title="Permalink to this heading"></a></h4>
<p>Export macro that indicates an external function, which is intended
for client use.</p>
</section>
<section id="define-gpr-ids-domain-id-invalid-v-0">
<h4>#define GPR_IDS_DOMAIN_ID_INVALID_V 0<a class="headerlink" href="#define-gpr-ids-domain-id-invalid-v-0" title="Permalink to this heading"></a></h4>
<p>Invalid domain.</p>
</section>
<section id="define-gpr-ids-domain-id-modem-v-1">
<h4>#define GPR_IDS_DOMAIN_ID_MODEM_V 1<a class="headerlink" href="#define-gpr-ids-domain-id-modem-v-1" title="Permalink to this heading"></a></h4>
<p>Modem DSP (mDSP) domain.</p>
</section>
<section id="define-gpr-ids-domain-id-adsp-v-2">
<h4>#define GPR_IDS_DOMAIN_ID_ADSP_V 2<a class="headerlink" href="#define-gpr-ids-domain-id-adsp-v-2" title="Permalink to this heading"></a></h4>
<p>Audio DSP (aDSP) domain.</p>
</section>
<section id="define-gpr-ids-domain-id-apps-v-3">
<h4>#define GPR_IDS_DOMAIN_ID_APPS_V 3<a class="headerlink" href="#define-gpr-ids-domain-id-apps-v-3" title="Permalink to this heading"></a></h4>
<p>Applications domain.</p>
</section>
<section id="define-gpr-ids-domain-id-sdsp-v-4">
<h4>#define GPR_IDS_DOMAIN_ID_SDSP_V 4<a class="headerlink" href="#define-gpr-ids-domain-id-sdsp-v-4" title="Permalink to this heading"></a></h4>
<p>Sensors DSP (sDSP) domain.</p>
</section>
<section id="define-gpr-ids-domain-id-cdsp-v-5">
<h4>#define GPR_IDS_DOMAIN_ID_CDSP_V 5<a class="headerlink" href="#define-gpr-ids-domain-id-cdsp-v-5" title="Permalink to this heading"></a></h4>
<p>Compute DSP (cDSP) domain.</p>
</section>
<section id="define-gpr-pl-max-domain-id-v">
<h4>#define GPR_PL_MAX_DOMAIN_ID_V<a class="headerlink" href="#define-gpr-pl-max-domain-id-v" title="Permalink to this heading"></a></h4>
<p>Highest domain ID.</p>
</section>
<section id="define-gpr-pl-num-total-domains-v">
<h4>#define GPR_PL_NUM_TOTAL_DOMAINS_V<a class="headerlink" href="#define-gpr-pl-num-total-domains-v" title="Permalink to this heading"></a></h4>
<p>Total number of domains.</p>
</section>
<section id="define-gpr-pkt-version-v">
<h4>#define GPR_PKT_VERSION_V<a class="headerlink" href="#define-gpr-pkt-version-v" title="Permalink to this heading"></a></h4>
<p>Defines the layout of the packet structure.</p>
</section>
<section id="define-gpr-pkt-init-port-v">
<h4>#define GPR_PKT_INIT_PORT_V<a class="headerlink" href="#define-gpr-pkt-init-port-v" title="Permalink to this heading"></a></h4>
<p>Uninitialized port value.</p>
</section>
<section id="define-gpr-pkt-init-reserved-v">
<h4>#define GPR_PKT_INIT_RESERVED_V<a class="headerlink" href="#define-gpr-pkt-init-reserved-v" title="Permalink to this heading"></a></h4>
<p>Uninitialized reserved field value.</p>
</section>
<section id="define-gpr-pkt-init-domain-id-v">
<h4>#define GPR_PKT_INIT_DOMAIN_ID_V<a class="headerlink" href="#define-gpr-pkt-init-domain-id-v" title="Permalink to this heading"></a></h4>
<p>Uninitialized domain ID value.</p>
</section>
<section id="define-gpr-pkt-header-word-size-v">
<h4>#define GPR_PKT_HEADER_WORD_SIZE_V<a class="headerlink" href="#define-gpr-pkt-header-word-size-v" title="Permalink to this heading"></a></h4>
<p>Header size in number of 32-bit words.</p>
</section>
<section id="define-gpr-pkt-header-byte-size-v">
<h4>#define GPR_PKT_HEADER_BYTE_SIZE_V<a class="headerlink" href="#define-gpr-pkt-header-byte-size-v" title="Permalink to this heading"></a></h4>
<p>Header size in number of bytes.</p>
</section>
<section id="define-gpr-undefined-id-v">
<h4>#define GPR_UNDEFINED_ID_V<a class="headerlink" href="#define-gpr-undefined-id-v" title="Permalink to this heading"></a></h4>
<p>Undefined value where a valid GUID is expected.</p>
</section>
<section id="define-gpr-pkt-init-client-data-v">
<h4>#define GPR_PKT_INIT_CLIENT_DATA_V<a class="headerlink" href="#define-gpr-pkt-init-client-data-v" title="Permalink to this heading"></a></h4>
<p>Uninitialized client data value.</p>
</section>
<section id="define-gpr-pkt-version-mask-0x0000000f">
<h4>#define GPR_PKT_VERSION_MASK ( 0x0000000F )<a class="headerlink" href="#define-gpr-pkt-version-mask-0x0000000f" title="Permalink to this heading"></a></h4>
<p>Bitmask of the version field.</p>
</section>
<section id="define-gpr-pkt-version-shft-0">
<h4>#define GPR_PKT_VERSION_SHFT ( 0 )<a class="headerlink" href="#define-gpr-pkt-version-shft-0" title="Permalink to this heading"></a></h4>
<p>Bit shift of the version field.</p>
</section>
<section id="define-gpr-pkt-header-size-mask-0x000000f0">
<h4>#define GPR_PKT_HEADER_SIZE_MASK ( 0x000000F0 )<a class="headerlink" href="#define-gpr-pkt-header-size-mask-0x000000f0" title="Permalink to this heading"></a></h4>
<p>Bitmask of the header size field.</p>
</section>
<section id="define-gpr-pkt-header-size-shft-4">
<h4>#define GPR_PKT_HEADER_SIZE_SHFT ( 4 )<a class="headerlink" href="#define-gpr-pkt-header-size-shft-4" title="Permalink to this heading"></a></h4>
<p>Bit shift of the header size field.</p>
</section>
<section id="define-gpr-pkt-reserved-mask-0xfff00000">
<h4>#define GPR_PKT_RESERVED_MASK ( 0xFFF00000 )<a class="headerlink" href="#define-gpr-pkt-reserved-mask-0xfff00000" title="Permalink to this heading"></a></h4>
<p>Bitmask of the reserved field. Includes four reserved bits from the
client data field.</p>
</section>
<section id="define-gpr-pkt-reserved-shft-20">
<h4>#define GPR_PKT_RESERVED_SHFT ( 20 )<a class="headerlink" href="#define-gpr-pkt-reserved-shft-20" title="Permalink to this heading"></a></h4>
<p>Bit shift of the reserved field.</p>
</section>
<section id="define-gpr-pkt-packet-size-mask-0xffffff00">
<h4>#define GPR_PKT_PACKET_SIZE_MASK ( 0xFFFFFF00 )<a class="headerlink" href="#define-gpr-pkt-packet-size-mask-0xffffff00" title="Permalink to this heading"></a></h4>
<p>Bitmask of the packet size field.</p>
</section>
<section id="define-gpr-pkt-packet-size-shft-8">
<h4>#define GPR_PKT_PACKET_SIZE_SHFT ( 8 )<a class="headerlink" href="#define-gpr-pkt-packet-size-shft-8" title="Permalink to this heading"></a></h4>
<p>Bit shift of the packet size field.</p>
</section>
<section id="define-gpr-get-bitmask-mask-shift-value">
<h4>#define GPR_GET_BITMASK( <em>mask, shift, value</em> )<a class="headerlink" href="#define-gpr-get-bitmask-mask-shift-value" title="Permalink to this heading"></a></h4>
<p>Gets the value of a field, including the specified mask and shift.</p>
</section>
<section id="define-gpr-set-bitmask-mask-shift-value">
<h4>#define GPR_SET_BITMASK( <em>mask, shift, value</em> )<a class="headerlink" href="#define-gpr-set-bitmask-mask-shift-value" title="Permalink to this heading"></a></h4>
<p>Sets a value in a field, including the specified mask and shift.</p>
</section>
<section id="define-gpr-get-field-field-value">
<h4>#define GPR_GET_FIELD( <em>field, value</em> )<a class="headerlink" href="#define-gpr-get-field-field-value" title="Permalink to this heading"></a></h4>
<p>Gets the value of a field.</p>
</section>
<section id="define-gpr-set-field-field-value">
<h4>#define GPR_SET_FIELD( <em>field, value</em> )<a class="headerlink" href="#define-gpr-set-field-field-value" title="Permalink to this heading"></a></h4>
<p>Sets a value in a field.</p>
</section>
<section id="define-gpr-ptr-end-of-base-ptr-offset">
<h4>#define GPR_PTR_END_OF( <em>base_ptr, offset</em> )<a class="headerlink" href="#define-gpr-ptr-end-of-base-ptr-offset" title="Permalink to this heading"></a></h4>
<p>Returns an 8-bit aligned pointer to a base address pointer plus an
offset in bytes.</p>
</section>
<section id="define-gpr-pkt-get-packet-byte-size-header">
<h4>#define GPR_PKT_GET_PACKET_BYTE_SIZE( <em>header</em> )<a class="headerlink" href="#define-gpr-pkt-get-packet-byte-size-header" title="Permalink to this heading"></a></h4>
<p>Given the packet header, returns the packet’s current size in bytes.
The current packet byte size is the sum of the base packet structure
and the used portion of the payload.</p>
</section>
<section id="define-gpr-pkt-get-header-byte-size-header">
<h4>#define GPR_PKT_GET_HEADER_BYTE_SIZE( <em>header</em> )<a class="headerlink" href="#define-gpr-pkt-get-header-byte-size-header" title="Permalink to this heading"></a></h4>
<p>Given the packet header, returns the header’s current size in bytes.</p>
</section>
<section id="define-gpr-pkt-get-payload-byte-size-header">
<h4>#define GPR_PKT_GET_PAYLOAD_BYTE_SIZE( <em>header</em> )<a class="headerlink" href="#define-gpr-pkt-get-payload-byte-size-header" title="Permalink to this heading"></a></h4>
<p>Given the packet header, returns the payload’s current size in
bytes.
The current payload byte size is the difference between the packet
size and the header size.</p>
</section>
<section id="define-gpr-pkt-get-payload-type-packet-ptr">
<h4>#define GPR_PKT_GET_PAYLOAD( <em>type, packet_ptr</em> )<a class="headerlink" href="#define-gpr-pkt-get-payload-type-packet-ptr" title="Permalink to this heading"></a></h4>
<p>Given the packet, returns a pointer to the beginning of the packet’s
payload.</p>
</section>
</section>
</section>
<section id="gpr-status-and-error-codes">
<span id="id5"></span><h2><a class="toc-backref" href="#id50" role="doc-backlink">GPR Status and Error Codes</a><a class="headerlink" href="#gpr-status-and-error-codes" title="Permalink to this heading"></a></h2>
<section id="id6">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">Define Documentation</a><a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<section id="define-ar-eok-0">
<h4>#define AR_EOK (0)<a class="headerlink" href="#define-ar-eok-0" title="Permalink to this heading"></a></h4>
<p>Success. The operation completed with no errors.</p>
</section>
<section id="define-ar-efailed-1">
<h4>#define AR_EFAILED (1)<a class="headerlink" href="#define-ar-efailed-1" title="Permalink to this heading"></a></h4>
<p>General failure.</p>
</section>
<section id="define-ar-ebadparam-2">
<h4>#define AR_EBADPARAM (2)<a class="headerlink" href="#define-ar-ebadparam-2" title="Permalink to this heading"></a></h4>
<p>Bad operation parameter.</p>
</section>
<section id="define-ar-eunsupported-3">
<h4>#define AR_EUNSUPPORTED (3)<a class="headerlink" href="#define-ar-eunsupported-3" title="Permalink to this heading"></a></h4>
<p>Unsupported routine or operation.</p>
</section>
<section id="define-ar-eversion-4">
<h4>#define AR_EVERSION (4)<a class="headerlink" href="#define-ar-eversion-4" title="Permalink to this heading"></a></h4>
<p>Unsupported version.</p>
</section>
<section id="define-ar-eunexpected-5">
<h4>#define AR_EUNEXPECTED (5)<a class="headerlink" href="#define-ar-eunexpected-5" title="Permalink to this heading"></a></h4>
<p>Unexpected problem encountered.</p>
</section>
<section id="define-ar-epanic-6">
<h4>#define AR_EPANIC (6)<a class="headerlink" href="#define-ar-epanic-6" title="Permalink to this heading"></a></h4>
<p>Unhandled problem occurred.</p>
</section>
<section id="define-ar-enoresource-7">
<h4>#define AR_ENORESOURCE (7)<a class="headerlink" href="#define-ar-enoresource-7" title="Permalink to this heading"></a></h4>
<p>Unable to allocate resource.</p>
</section>
<section id="define-ar-ehandle-8">
<h4>#define AR_EHANDLE (8)<a class="headerlink" href="#define-ar-ehandle-8" title="Permalink to this heading"></a></h4>
<p>Invalid handle.</p>
</section>
<section id="define-ar-ealready-9">
<h4>#define AR_EALREADY (9)<a class="headerlink" href="#define-ar-ealready-9" title="Permalink to this heading"></a></h4>
<p>Operation is already processed.</p>
</section>
<section id="define-ar-enotready-10">
<h4>#define AR_ENOTREADY (10)<a class="headerlink" href="#define-ar-enotready-10" title="Permalink to this heading"></a></h4>
<p>Operation is not ready to be processed.</p>
</section>
<section id="define-ar-epending-11">
<h4>#define AR_EPENDING (11)<a class="headerlink" href="#define-ar-epending-11" title="Permalink to this heading"></a></h4>
<p>Operation is pending completion.</p>
</section>
<section id="define-ar-ebusy-12">
<h4>#define AR_EBUSY (12)<a class="headerlink" href="#define-ar-ebusy-12" title="Permalink to this heading"></a></h4>
<p>Operation cannot be accepted or processed.</p>
</section>
<section id="define-ar-eaborted-13">
<h4>#define AR_EABORTED (13)<a class="headerlink" href="#define-ar-eaborted-13" title="Permalink to this heading"></a></h4>
<p>Operation was aborted due to an error.</p>
</section>
<section id="define-ar-econtinue-14">
<h4>#define AR_ECONTINUE (14)<a class="headerlink" href="#define-ar-econtinue-14" title="Permalink to this heading"></a></h4>
<p>Operation requests an intervention to complete.</p>
</section>
<section id="define-ar-eimmediate-15">
<h4>#define AR_EIMMEDIATE (15)<a class="headerlink" href="#define-ar-eimmediate-15" title="Permalink to this heading"></a></h4>
<p>Operation requests an immediate intervention to complete.</p>
</section>
<section id="define-ar-enotimpl-16">
<h4>#define AR_ENOTIMPL (16)<a class="headerlink" href="#define-ar-enotimpl-16" title="Permalink to this heading"></a></h4>
<p>Operation was not implemented.</p>
</section>
<section id="define-ar-eneedmore-17">
<h4>#define AR_ENEEDMORE (17)<a class="headerlink" href="#define-ar-eneedmore-17" title="Permalink to this heading"></a></h4>
<p>Operation needs more data or resources.</p>
</section>
<section id="define-ar-enomemory-18">
<h4>#define AR_ENOMEMORY (18)<a class="headerlink" href="#define-ar-enomemory-18" title="Permalink to this heading"></a></h4>
<p>Operation does not have memory.</p>
</section>
<section id="define-ar-enotexist-19">
<h4>#define AR_ENOTEXIST (19)<a class="headerlink" href="#define-ar-enotexist-19" title="Permalink to this heading"></a></h4>
<p>Item does not exist.</p>
</section>
<section id="define-ar-eterminated-20">
<h4>#define AR_ETERMINATED (20)<a class="headerlink" href="#define-ar-eterminated-20" title="Permalink to this heading"></a></h4>
<p>Operation is finished.</p>
</section>
<section id="define-ar-etimeout-21">
<h4>#define AR_ETIMEOUT (21)<a class="headerlink" href="#define-ar-etimeout-21" title="Permalink to this heading"></a></h4>
<p>Operation timeout.</p>
</section>
<section id="define-ar-succeeded-x">
<h4>#define AR_SUCCEEDED( <em>x</em> )<a class="headerlink" href="#define-ar-succeeded-x" title="Permalink to this heading"></a></h4>
<p>Macro that checks whether a result is a success.</p>
</section>
<section id="define-ar-failed-x">
<h4>#define AR_FAILED( <em>x</em> )<a class="headerlink" href="#define-ar-failed-x" title="Permalink to this heading"></a></h4>
<p>Macro that checks whether a result is a failure.</p>
</section>
</section>
</section>
<section id="gpr-core-packet-structure">
<h2><a class="toc-backref" href="#id52" role="doc-backlink">GPR Core Packet Structure</a><a class="headerlink" href="#gpr-core-packet-structure" title="Permalink to this heading"></a></h2>
<section id="data-structure-documentation">
<h3><a class="toc-backref" href="#id53" role="doc-backlink">Data Structure Documentation</a><a class="headerlink" href="#data-structure-documentation" title="Permalink to this heading"></a></h3>
<section id="struct-gpr-packet-t">
<h4>struct gpr_packet_t<a class="headerlink" href="#struct-gpr-packet-t" title="Permalink to this heading"></a></h4>
<p>Core header structure necessary to route a packet from a source to a
destination.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>header</p></td>
<td><p>Contains the following subfield information for the header field.</p>
<p><strong>version</strong></p>
<ul class="simple">
<li><p>Bits 3 to 0 (four bits).</p></li>
<li><p>Defines the layout of the packet structure.</p></li>
</ul>
<p><strong>header_size</strong></p>
<ul class="simple">
<li><p>Bits 7 to 4 (four bits).</p></li>
<li><p>The header size is the number of 32-bit header words starting. from the beginning of the packet.</p></li>
</ul>
<p><strong>packet_size</strong></p>
<ul class="simple">
<li><p>Bits 31 to 8 (twenty-four bits).</p></li>
<li><p>The total packet size in bytes.</p></li>
<li><p>The total packet size includes both the header and payload size.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>uint8_t</p></td>
<td><p>dst_domain_id</p></td>
<td><p>Domain ID of the destination where the packet is to be delivered.</p>
<ul class="simple">
<li><p>Bits 0 to 7 (eight bits).</p></li>
<li><p>The domain ID refers to a process, a processor, or an off-target location that houses GPR.</p></li>
<li><p>The transport layer used may differ depending on the physical link between domains.</p></li>
<li><p>All domain ID values are reserved by GPR.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>src_domain_id</p></td>
<td><p>Domain ID of the source from where the packet came.</p>
<ul class="simple">
<li><p>Bits 8 to 15 (eight bits).</p></li>
<li><p>The domain ID refers to a process, a processor, or an off-target location that houses GPR.</p></li>
<li><p>The transport layer used may differ depending on the physical link between domains.</p></li>
<li><p>All domain ID values are reserved by the GPR.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>uint8_t</p></td>
<td><p>client_data</p></td>
<td><p>Used for client-specific needs.</p>
<ul class="simple">
<li><p>Bits 16 to 23 (eight bits).</p></li>
<li><p>4 bits for use by client.</p></li>
<li><p>4 bits are reserved and to be set to 0.</p></li>
<li><p>Default value to be set to 0.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>reserved</p></td>
<td><p>Reserved field.</p>
<ul class="simple">
<li><p>Bits 24 to 31 (eight bits).</p></li>
<li><p>Set the value to 0.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>src_port</p></td>
<td><p>Unique ID of the service from where the packet came.</p>
<ul class="simple">
<li><p>Bits 31 to 0 (thirty-two bits).</p></li>
<li><p>The src_port refers to the ID that the sender service registers with the GPR. This ID must be unique to the service within a given domain.</p></li>
<li><p>Service refers to any functional block, such as a module, that is required to send or receive packets through the GPR.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>dst_port</p></td>
<td><p>Unique ID of the service where the packet is to be delivered.</p>
<ul class="simple">
<li><p>Bits 31 to 0 (thirty-two bits).</p></li>
<li><p>The dst_port refers to the ID that the receiver service registers with the GPR. This ID must be unique to the service within a given domain.</p></li>
<li><p>Service refers to any functional block, fsuch as a module, that is required to send or receive packets through the GPR.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>token</p></td>
<td><p>Client transaction ID provided by the sender.</p>
<p>Bits 31 to 0 (thirty-two bits).</p>
</td>
</tr>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>opcode</p></td>
<td><p>Defines both the action and the payload structure.</p>
<p><strong>Supported values:</strong></p>
<ul class="simple">
<li><p>Bits 31 to 0 (thirty-two bits).</p></li>
<li><p>This operation code is a Globally Unique ID (GUID) and must be a valid value.</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="callback-function-prototype">
<h2><a class="toc-backref" href="#id54" role="doc-backlink">Callback Function Prototype</a><a class="headerlink" href="#callback-function-prototype" title="Permalink to this heading"></a></h2>
<section id="typedef-documentation">
<h3><a class="toc-backref" href="#id55" role="doc-backlink">Typedef Documentation</a><a class="headerlink" href="#typedef-documentation" title="Permalink to this heading"></a></h3>
<section id="typedef-uint32-t-gpr-callback-fn-t-gpr-packet-t-packet-void-callback-data">
<h4>typedef uint32_t(gpr_callback_fn_t)(gpr_packet_t ∗packet, void callback_data)<a class="headerlink" href="#typedef-uint32-t-gpr-callback-fn-t-gpr-packet-t-packet-void-callback-data" title="Permalink to this heading"></a></h4>
<p>Prototype of a packet callback function.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>packet</em></p></th>
<th class="head"><p>Pointer to the incoming packet. The packet is guaranteed to</p>
<p>have a non-NULL value.</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>callback_data</em></p></td>
<td><p>Client-supplied data pointer that the service provided at</p>
<p>registration time.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful, indicates that the
callee has taken ownership of the packet. Otherwise, an error (see
<a class="reference internal" href="#gpr-status-and-error-codes"><span class="std std-ref">GPR Status and Error Codes</span></a>) – The packet ownership is
returned to the caller.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="gpr-core-routines">
<h2><a class="toc-backref" href="#id56" role="doc-backlink">GPR Core Routines</a><a class="headerlink" href="#gpr-core-routines" title="Permalink to this heading"></a></h2>
<section id="function-documentation">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">Function Documentation</a><a class="headerlink" href="#function-documentation" title="Permalink to this heading"></a></h3>
<section id="gpr-external-uint32-t-gpr-init-void">
<h4>GPR_EXTERNAL uint32_t gpr_init ( void )<a class="headerlink" href="#gpr-external-uint32-t-gpr-init-void" title="Permalink to this heading"></a></h4>
<blockquote>
<div><p>Performs external initialization of the GPR infrastructure.</p>
<p>Each supported domain calls this function once during system
bring-up or during runtime to initialize the GPR infrastructure for
that domain. The GPR infrastructure must be initialized before any
other GPR APIs can be called.</p>
</div></blockquote>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
</div></blockquote>
<p><strong>Dependencies</strong></p>
<blockquote>
<div><p>None.</p>
</div></blockquote>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api.h&quot;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_init</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not initialize the GPR infrastructure&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="gpr-external-uint32-t-gpr-deinit-void">
<h4>GPR_EXTERNAL uint32_t gpr_deinit ( void )<a class="headerlink" href="#gpr-external-uint32-t-gpr-deinit-void" title="Permalink to this heading"></a></h4>
<p>Performs external deinitialization of the GPR infrastructure.
Each supported domain calls this function once during system
shutdown or during runtime to deinitialize the GPR infrastructure
for that domain. No functions except for
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a> can be called
after the GPR infrastructure is deinitialized.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api.h&quot;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_deinit</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not deinitialize the GPR infrastructure&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="gpr-external-uint32-t-gpr-drv-init-void">
<h4>GPR_EXTERNAL uint32_t gpr_drv_init ( void )<a class="headerlink" href="#gpr-external-uint32-t-gpr-drv-init-void" title="Permalink to this heading"></a></h4>
<p>Called from <a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>
to initialize the GPR infrastructure.
This function is defined in each platform wrapper( see Section
<a class="reference internal" href="#platform-specific-configuration-wrappers"><span class="std std-ref">Platform-specific Configuration Wrappers</span></a>) and further
calls <a class="reference external" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">gpr_drv_internal_init()</a> to perform GPR
internal initialization.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
</section>
<section id="gpr-internal-uint32-t-gpr-drv-deinit-void">
<h4>GPR_INTERNAL uint32_t gpr_drv_deinit ( void )<a class="headerlink" href="#gpr-internal-uint32-t-gpr-drv-deinit-void" title="Permalink to this heading"></a></h4>
<p>Called from
<a class="reference external" href="#gpr-external-uint32-t-gpr-deinit-void">gpr_deinit()</a> to
deinitialize the GPR infrastructure.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
</section>
</section>
</section>
<section id="gpr-fundamental-controls">
<h2><a class="toc-backref" href="#id58" role="doc-backlink">GPR Fundamental Controls</a><a class="headerlink" href="#gpr-fundamental-controls" title="Permalink to this heading"></a></h2>
<section id="register-a-service">
<h3><a class="toc-backref" href="#id59" role="doc-backlink">Register a Service</a><a class="headerlink" href="#register-a-service" title="Permalink to this heading"></a></h3>
<section id="id7">
<h4>Function Documentation<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-register-uint32-t-src-port-gpr-callback-fn-t-void-callback-data">
<h5>static uint32_t gpr_cmd_register ( uint32_t <em>src_port,</em> gpr_callback_fn_t, void * callback_data)<a class="headerlink" href="#static-uint32-t-gpr-cmd-register-uint32-t-src-port-gpr-callback-fn-t-void-callback-data" title="Permalink to this heading"></a></h5>
<p>Registers a service, by its unique service ID, with the GPR.</p>
<p><strong>Associated data types</strong></p>
<p>gpr_callback_fn_t</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>src_port</em></p></th>
<th class="head"><p>Unique ID (within a domain) of the service to be registered.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>callback_fn</em></p></td>
<td><p>Callback function of the service to be registered.</p></td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>callback_data</em></p></td>
<td><p>Pointer to the client-supplied data pointer for the callback</p>
<p>function.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<blockquote>
<div><p>Services call this command once during system bring-up or runtime to
register their presence with the GPR.</p>
<p>A service is any functional block, such as a module, that is
required to send or receive GPR packets. Services must be registered
with the GPR before they can send or receive any messages.</p>
</div></blockquote>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><a class="reference external" href="#define-ar-ealready-9">AR_EALREADY</a> – Service has already been
registered.</p>
</div></blockquote>
<p><strong>Dependencies</strong></p>
<blockquote>
<div><p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
</div></blockquote>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="c1">//Example of a test client service (with service ID GPR_TESTCLIENT_SERVICE_ID)</span>
<span class="c1">//trying to register with GPR.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="nf">service_callback_fn</span><span class="p">(</span><span class="n">gpr_packet_t</span><span class="w"> </span><span class="o">*</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">callback_data</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">callback_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_register</span><span class="p">(</span><span class="n">GPR_TESTCLIENT_SERVICE_ID</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">callback_fn</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">callback_data</span><span class="p">);</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not register the test client service with GPR&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//Example of a callback function for a service. It is invoked by GPR</span>
<span class="c1">//every time a message is sent or received, to or from that service.</span>
<span class="k">static</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="nf">service_callback_fn</span><span class="p">(</span><span class="w"> </span><span class="n">gpr_packet_t</span><span class="o">*</span><span class="w"> </span><span class="n">packet</span><span class="p">,</span>
<span class="w">                                    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">callback_data</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// Accept command by replying to the sender that the message is accepted.</span>
<span class="w">   </span><span class="c1">// The usage is optional.</span>
<span class="w">   </span><span class="n">__gpr_cmd_accept_command</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="p">);</span>

<span class="w">   </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="w"> </span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">     </span><span class="k">case</span><span class="w"> </span><span class="no">TEST_CLIENT_CMD_FUNCTION</span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// Handle accordingly based on operation code and send response to</span>
<span class="w">       </span><span class="c1">// the sender that command is completed.</span>
<span class="w">       </span><span class="n">__gpr_cmd_end_command</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="n">AR_EOK</span><span class="w"> </span><span class="p">);</span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">     </span><span class="k">case</span><span class="w"> </span><span class="no">TEST_CLIENT_RSP_FUNCTION</span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// Notify command completion.</span>
<span class="w">       </span><span class="c1">// Response may contain payload, free the packet after handling.</span>
<span class="w">       </span><span class="n">__gpr_cmd_free</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="p">);</span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">     </span><span class="k">case</span><span class="w"> </span><span class="no">GPR_IBASIC_RSP_RESULT</span><span class="p">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// Notify command completion, response contains the error status.</span>
<span class="w">       </span><span class="n">__gpr_cmd_free</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="p">);</span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">     </span><span class="k">default</span><span class="o">:</span>
<span class="w">     </span><span class="p">{</span>
<span class="w">       </span><span class="c1">// Free unsupported events and command responses.</span>
<span class="w">       </span><span class="n">__gpr_cmd_free</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="p">);</span>
<span class="w">       </span><span class="k">break</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">AR_EOK</span><span class="p">;</span>
<span class="w">   </span><span class="c1">// AR_EOK tells the caller that the packet was consumed (freed).</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="deregister-a-service">
<h3><a class="toc-backref" href="#id60" role="doc-backlink">Deregister a Service</a><a class="headerlink" href="#deregister-a-service" title="Permalink to this heading"></a></h3>
<section id="id8">
<h4>Function Documentation<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-deregister-uint32-t-src-port">
<h5>static uint32_t gpr_cmd_deregister ( uint32_t src_port )<a class="headerlink" href="#static-uint32-t-gpr-cmd-deregister-uint32-t-src-port" title="Permalink to this heading"></a></h5>
<p>Deregisters a service from the GPR.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>src_port</em></p></td>
<td><p>Unique ID of the service.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<blockquote>
<div><p>Services call this function once during system teardown or runtime
to deregister their presence from the GPR.</p>
</div></blockquote>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
</div></blockquote>
<p><strong>Dependencies</strong></p>
<blockquote>
<div><p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
</div></blockquote>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="c1">//Example of a test client service (with service ID GPR_TESTCLIENT_SERVICE_ID)</span>
<span class="c1">//trying to deregister from GPR.</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="nf">callback_fn</span><span class="p">(</span><span class="n">gpr_packet_t</span><span class="w"> </span><span class="o">*</span><span class="n">packet</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">callback_data</span><span class="p">);</span>
<span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">callback_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_register</span><span class="p">(</span><span class="n">GPR_TESTCLIENT_SERVICE_ID</span><span class="p">,</span>
<span class="w">                                </span><span class="n">callback_fn</span><span class="p">,</span>
<span class="w">                                </span><span class="n">callback_data</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not register the client service with GPR&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">__gpr_cmd_deregister</span><span class="p">(</span><span class="n">GPR_TESTCLIENT_SERVICE_ID</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not deregister the client service from GPR&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="query-for-registered-service">
<h3><a class="toc-backref" href="#id61" role="doc-backlink">Query for Registered Service</a><a class="headerlink" href="#query-for-registered-service" title="Permalink to this heading"></a></h3>
<section id="id9">
<h4>Function Documentation<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h4>
<p><strong>static uint32_t</strong> <strong>gpr_cmd_is_registered ( uint32_t port, bool_t *is_registered)</strong></p>
<p>Called by the framework to check whether a service is registered
with the GPR.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>port</em></p></th>
<th class="head"><p>Unique ID of the service.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>out</p></td>
<td><p><em>is_registered</em></p></td>
<td><p>Pointer to the client-supplied flag that returns TRUE if service</p>
<p>is registered and FALSE if the service is not registered.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a>.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="c1">//Example to check if test client service (with service ID GPR_TESTCLIENT_SERVICE_ID)</span>
<span class="c1">// is registered with GPR.</span>
<span class="n">bool_t</span><span class="w"> </span><span class="n">is_registered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FALSE</span><span class="p">;</span>
<span class="n">__gpr_cmd_is_registered</span><span class="p">(</span><span class="n">GPR_TESTCLIENT_SERVICE_ID</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">is_registered</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="n">TRUE</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">is_registered</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Client service registered with GPR&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Client service not registered with GPR&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="query-for-local-or-host-domain">
<h3><a class="toc-backref" href="#id62" role="doc-backlink">Query for Local or Host Domain</a><a class="headerlink" href="#query-for-local-or-host-domain" title="Permalink to this heading"></a></h3>
<section id="id10">
<h4>Function Documentation<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-get-host-domain-id-uint32-t-host-domain-id">
<h5>static uint32_t gpr_cmd_get_host_domain_id (uint32_t *host_domain_id)<a class="headerlink" href="#static-uint32-t-gpr-cmd-get-host-domain-id-uint32-t-host-domain-id" title="Permalink to this heading"></a></h5>
<p>Queries the GPR to get the local or host domain ID.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>out</p></td>
<td><p><em>host_domain_id</em></p></td>
<td><p>Pointer to the GPR’s host domain ID.</p></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> always.- Returns the host domain ID</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="kt">uint32_t</span><span class="w"> </span><span class="n">host_domain_id</span><span class="p">;</span>
<span class="n">__gpr_cmd_host_domain_id</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">host_domain_id</span><span class="w"> </span><span class="p">);</span>
<span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;GPR is in domain ID: %d &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">host_domain_id</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="query-for-packet-pool-information">
<h3><a class="toc-backref" href="#id63" role="doc-backlink">Query for Packet Pool Information</a><a class="headerlink" href="#query-for-packet-pool-information" title="Permalink to this heading"></a></h3>
<section id="id11">
<h4>Function Documentation<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-get-gpr-packet-info-gpr-cmd-gpr-packet-pool-info-t-args">
<h5>static uint32_t gpr_cmd_get_gpr_packet_info (gpr_cmd_gpr_packet_pool_info_t *args)<a class="headerlink" href="#static-uint32-t-gpr-cmd-get-gpr-packet-info-gpr-cmd-gpr-packet-pool-info-t-args" title="Permalink to this heading"></a></h5>
<p>Queries for the GPR’s packet pool information.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p>gpr_cmd_gpr_packet_pool_info_t</p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>out</p></td>
<td><p><em>args</em></p></td>
<td><p>Pointer to the packet pool information, such as the number and</p>
<p>sizes of the packets.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function returns following information:</p>
<ul class="simple">
<li><p>Minimum and maximum sizes (in bytes) of the packets allocated by the
GPR.</p></li>
<li><p>Maximum number of each packet.</p></li>
</ul>
<p>The number of packets does not translate to the packets that are
currently available. The number is the total or maximum number of
packets allocated during initialization.
Clients can use this information to decide whether to send inband or
out-of-band commands.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – Returns the GPR packet pool
information.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="n">gpr_cmd_gpr_packet_pool_info_t</span><span class="w"> </span><span class="n">packet_info</span><span class="p">;</span>
<span class="n">__gpr_cmd_get_gpr_packet_info</span><span class="p">(</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet_info</span><span class="w"> </span><span class="p">);</span>

<span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;GPR packet pool information:</span>
<span class="w">         </span><span class="n">Bytes</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">minimum</span><span class="o">-</span><span class="n">sized</span><span class="w"> </span><span class="n">gpr</span><span class="w"> </span><span class="n">packet</span><span class="o">:</span><span class="w"> </span><span class="o">%</span><span class="n">d</span><span class="p">,</span>
<span class="w">         </span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">minimum</span><span class="o">-</span><span class="n">sized</span><span class="w"> </span><span class="n">gpr</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">initialization</span><span class="o">:</span><span class="w"> </span><span class="o">%</span><span class="n">d</span><span class="p">,</span>
<span class="w">         </span><span class="n">Bytes</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">maximum</span><span class="o">-</span><span class="n">sized</span><span class="w"> </span><span class="n">gpr</span><span class="w"> </span><span class="n">packet</span><span class="o">:</span><span class="w"> </span><span class="o">%</span><span class="n">d</span><span class="p">,</span>
<span class="w">         </span><span class="n">Number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">maximum</span><span class="o">-</span><span class="n">sized</span><span class="w"> </span><span class="n">gpr</span><span class="w"> </span><span class="n">packets</span><span class="w"> </span><span class="n">allocated</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">initialization</span><span class="o">:</span><span class="w"> </span><span class="o">%</span><span class="n">d</span><span class="w"> </span><span class="s">&quot;,</span>
<span class="w">         </span><span class="n">packet_info</span><span class="p">.</span><span class="n">bytes_per_min_size_packet</span><span class="p">,</span>
<span class="w">         </span><span class="n">packet_info</span><span class="p">.</span><span class="n">num_min_size_packets</span><span class="p">,</span>
<span class="w">         </span><span class="n">packet_info</span><span class="p">.</span><span class="n">bytes_per_max_size_packet</span><span class="p">,</span>
<span class="w">         </span><span class="n">packet_info</span><span class="p">.</span><span class="n">num_max_size_packets</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="struct-gpr-cmd-gpr-packet-pool-info-t">
<h4>struct gpr_cmd_gpr_packet_pool_info_t<a class="headerlink" href="#struct-gpr-cmd-gpr-packet-pool-info-t" title="Permalink to this heading"></a></h4>
<p>Contains the packet pool information for
<a class="reference external" href="#static-uint32-t-gpr-cmd-get-gpr-packet-info-gpr-cmd-gpr-packet-pool-info-t-args">gpr_cmd_get_gpr_packet_info()</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>bytes_per_min-</p>
<p>_size_packet</p>
</td>
<td><p>Minimum size (in bytes) of a GPR packet.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>num_min_size-</p>
<p>_packets</p>
</td>
<td><p>Number of packets of the minimum size allocated at initialization.</p></td>
</tr>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>bytes_per_max-</p>
<p>_size_packet</p>
</td>
<td><p>Maximum size (in bytes) of a GPR packet.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>num_max_size-</p>
<p>_packets</p>
</td>
<td><p>Number of packets of the maximum size allocated at initialization.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="send-an-asynchronous-message">
<h3><a class="toc-backref" href="#id64" role="doc-backlink">Send an Asynchronous Message</a><a class="headerlink" href="#send-an-asynchronous-message" title="Permalink to this heading"></a></h3>
<section id="id12">
<h4>Function Documentation<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">
<h5>static uint32_t gpr_cmd_async_send (gpr_packet_t <em>packet</em> )<a class="headerlink" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet" title="Permalink to this heading"></a></h5>
<p>Sends an asynchronous message to other services.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>packet</em></p></td>
<td><p>Pointer to the packet (message) to send.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function provides the caller with low-level control over the
sending process. For general use, consider using a simplified helper
function, such as
<a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-send-gpr-cmd-alloc-send-t-args">gpr_cmd_alloc_send()</a>.
Before calling this function, use
<a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-uint32-t-alloc-size-gpr-packet-t-ret-packet">gpr_cmd_alloc()</a> or
<a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-ext-gpr-cmd-alloc-ext-t-args">gpr_cmd_alloc_ext()</a>
to allocate free messages for sending. If delivery fails, the caller
can try to resend the messages or abort and free messages.</p>
<p><strong>Notes</strong></p>
<p>The sender must always anticipate failures, even when this function
returns no errors. The
<a class="reference external" href="#define-gpr-ibasic-rsp-result-0x02001005">GPR_IBASIC_RSP_RESULT</a>
response messages are to be checked for any error statuses that are
returned.
The sender can locally abort any remotely pending operations by
implementing timeouts. The sender must still expect and handle
receipt of response messages for those aborted operations.</p>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
</div></blockquote>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.
The source and destination services must be registered with the GPR.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="n">gpr_packet_t</span><span class="o">*</span><span class="w"> </span><span class="n">packet_ptr</span><span class="p">;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">payload_size</span><span class="p">;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">packet_size</span><span class="p">;</span>

<span class="c1">//Example of a payload structure that needs to be populated and sent.</span>
<span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>
<span class="n">payload_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="p">);</span>
<span class="n">packet_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">payload_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GPR_PKT_HEADER_WORD_SIZE_V</span><span class="p">;</span>

<span class="c1">// Allocate a free packet.</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_alloc</span><span class="p">(</span><span class="w"> </span><span class="n">payload_size</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">AR_ENORESOURCE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Fill in the packet details.</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">header</span><span class="w"> </span><span class="n">GPR_SET_FIELD</span><span class="p">(</span><span class="n">GPR_PKT_VERSION</span><span class="p">,</span><span class="w"> </span><span class="n">GPR_PKT_VERSION_V</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="w">               </span><span class="n">GPR_SET_FIELD</span><span class="p">(</span><span class="n">GPR_PKT_HEADER_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">GPR_PKT_HEADER_WORD_SIZE_V</span><span class="p">)</span><span class="w"> </span><span class="o">|</span>
<span class="w">               </span><span class="n">GPR_SET_FIELD</span><span class="p">(</span><span class="n">GPR_PKT_PACKET_SIZE</span><span class="p">,</span><span class="w"> </span><span class="n">packet_size</span><span class="p">);</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">dst_domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_DESTINATION</span><span class="p">;</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">src_domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_SOURCE</span><span class="p">;</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">dst_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_DESTINATION</span><span class="p">;</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">src_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_SOURCE</span><span class="p">;</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span>
<span class="n">packet</span><span class="o">-&gt;</span><span class="n">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_CLIENT_CMD_FUNCTION</span><span class="p">;</span>

<span class="c1">// Fill in the payload.</span>
<span class="n">payload</span><span class="p">.</span><span class="n">param1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">payload</span><span class="p">.</span><span class="n">param2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="n">memscpy</span><span class="p">(</span><span class="w"> </span><span class="n">GPR_PKT_GET_PAYLOAD</span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">payload_size</span><span class="p">,</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="n">payload_size</span><span class="w"> </span><span class="p">);</span>

<span class="c1">// Send the packet.</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_async_send</span><span class="p">(</span><span class="w"> </span><span class="n">packet_ptr</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Free the packet when delivery fails.</span>
<span class="w">  </span><span class="p">(</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">__gpr_cmd_free</span><span class="p">(</span><span class="w"> </span><span class="n">packet_ptr</span><span class="w"> </span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="allocate-a-free-message-for-delivery">
<h3><a class="toc-backref" href="#id65" role="doc-backlink">Allocate a Free Message for Delivery</a><a class="headerlink" href="#allocate-a-free-message-for-delivery" title="Permalink to this heading"></a></h3>
<section id="id13">
<h4>Function Documentation<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-alloc-uint32-t-alloc-size-gpr-packet-t-ret-packet">
<h5>static uint32_t gpr_cmd_alloc ( uint32_t alloc_size, gpr_packet_t **ret_packet)<a class="headerlink" href="#static-uint32-t-gpr-cmd-alloc-uint32-t-alloc-size-gpr-packet-t-ret-packet" title="Permalink to this heading"></a></h5>
<p>Allocates a free message for delivery.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>alloc_size</em></p></th>
<th class="head"><p>Amount of memory (in bytes) required for allocation.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>out</p></td>
<td><p><em>ret_packet</em></p></td>
<td><p>Double pointer to the allocated packet that is returned by this</p>
<p>function.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function allocates a packet from the GPR’s free packet queue.
It provides the caller with low-level control over the allocation
process.
For general use, consider using a simplified helper function, such
as
<a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-ext-gpr-cmd-alloc-ext-t-args">gpr_cmd_alloc_ext()</a>.
<strong>Returns</strong>
<a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
<p><strong>Code example</strong></p>
<p>See the code example for
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>.</p>
</section>
</section>
</section>
<section id="free-a-packet-from-a-queue">
<h3><a class="toc-backref" href="#id66" role="doc-backlink">Free a Packet from a Queue</a><a class="headerlink" href="#free-a-packet-from-a-queue" title="Permalink to this heading"></a></h3>
<section id="id14">
<h4>Function Documentation<a class="headerlink" href="#id14" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-free-gpr-packet-t-packet">
<h5>static uint32_t gpr_cmd_free ( gpr_packet_t *packet)<a class="headerlink" href="#static-uint32-t-gpr-cmd-free-gpr-packet-t-packet" title="Permalink to this heading"></a></h5>
<p>Frees a specified GPR packet and returns it to the owner.</p>
<p><strong>Associated data types</strong></p>
<p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>packet</em></p></td>
<td><p>Pointer to the GPR packet to be freed.</p></td>
</tr>
</tbody>
</table>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.</p>
<p><strong>Code example</strong></p>
<p>See the code example for
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>.</p>
</section>
</section>
</section>
</section>
<section id="gpr-utility-controls">
<h2><a class="toc-backref" href="#id67" role="doc-backlink">GPR Utility Controls</a><a class="headerlink" href="#gpr-utility-controls" title="Permalink to this heading"></a></h2>
<section id="allocate-part-of-a-message">
<h3><a class="toc-backref" href="#id68" role="doc-backlink">Allocate Part of a Message</a><a class="headerlink" href="#allocate-part-of-a-message" title="Permalink to this heading"></a></h3>
<section id="id15">
<h4>Function Documentation<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<section id="static-uint32-t-gpr-cmd-alloc-ext-gpr-cmd-alloc-ext-t-args">
<h5>static uint32_t gpr_cmd_alloc_ext (gpr_cmd_alloc_ext_t *args )<a class="headerlink" href="#static-uint32-t-gpr-cmd-alloc-ext-gpr-cmd-alloc-ext-t-args" title="Permalink to this heading"></a></h5>
<p>Allocates a formatted free packet for delivery.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-cmd-alloc-ext-t">gpr_cmd_alloc_ext_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>args</em></p></td>
<td><p>Pointer to the allocated packet information, such as domain and</p>
<p>port IDs, token and opcode values, and payload size.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This helper function partially creates a packet for delivery. It
performs the packet allocation and initialization, but the packet
payload is dependent on the caller to fill in.
This two-step process allows the caller to avoid multiple memscpy()
operations on the packet payload.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.
The source and destination services must be registered with the GPR.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="n">gpr_packet_t</span><span class="o">*</span><span class="w"> </span><span class="n">packet_ptr</span><span class="p">;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">payload_size</span><span class="p">;</span>

<span class="c1">//Example payload required to be sent.</span>
<span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>

<span class="n">gpr_cmd_alloc_ext_t</span><span class="w"> </span><span class="n">alloc_args</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">src_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_SOURCE</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">src_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_SOURCE</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">dst_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_DESTINATION</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">dst_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_DESTINATION</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_CLIENT_CMD_FUNCTION</span><span class="p">;</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">payload_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="p">);</span>
<span class="n">alloc_args</span><span class="p">.</span><span class="n">ret_packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">packet_ptr</span><span class="p">;</span>

<span class="c1">// Allocate memory for the packet.</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_alloc_ext</span><span class="p">(</span><span class="n">alloc_args</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Packet allocation failed&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">AR_EFAILED</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Fill in the payload.</span>
<span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_PKT_GET_PAYLOAD</span><span class="p">(</span><span class="w"> </span><span class="n">test_client_cmd_function_t</span><span class="p">,</span><span class="w"> </span><span class="n">packet_ptr</span><span class="w"> </span><span class="p">);</span>
<span class="n">payload</span><span class="o">-&gt;</span><span class="n">param1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">payload</span><span class="o">-&gt;</span><span class="n">param2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="c1">// Send the packet.</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_async_send</span><span class="p">(</span><span class="w"> </span><span class="n">packet_ptr</span><span class="w"> </span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not send the packet.</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="struct-gpr-cmd-alloc-ext-t">
<h4>struct gpr_cmd_alloc_ext_t<a class="headerlink" href="#struct-gpr-cmd-alloc-ext-t" title="Permalink to this heading"></a></h4>
<p>Contains the allocated packet information for <a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-ext-gpr-cmd-alloc-ext-t-args">gpr_cmd_alloc_ext()</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>src_domain_id</p></td>
<td><p>Domain ID of the sender service.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>src_port</p></td>
<td><p>Registered unique ID of the sender service.</p></td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>dst_domain_id</p></td>
<td><p>Domain ID of the receiver service.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>dst_port</p></td>
<td><p>Registered unique ID of the receiver service.</p></td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>client_data</p></td>
<td><p>Reserved for use by client.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>token</p></td>
<td><p>Value attached by the sender to determine when command messages</p>
<p>are processed by the receiver after they receive response messages.</p>
</td>
</tr>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>opcode</p></td>
<td><p>Defines both the action and the payload structure to the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>payload_size</p></td>
<td><p>Actual number of bytes required for the payload.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a> ∗∗</p></td>
<td><p>ret_packet</p></td>
<td><p>Double pointer to the formatted packet returned by the function.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="allocate-and-send-a-message">
<h2><a class="toc-backref" href="#id69" role="doc-backlink">Allocate and Send a Message</a><a class="headerlink" href="#allocate-and-send-a-message" title="Permalink to this heading"></a></h2>
<section id="id16">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">Function Documentation</a><a class="headerlink" href="#id16" title="Permalink to this heading"></a></h3>
<section id="static-uint32-t-gpr-cmd-alloc-send-gpr-cmd-alloc-send-t-args">
<h4>static uint32_t gpr_cmd_alloc_send (gpr_cmd_alloc_send_t args )<a class="headerlink" href="#static-uint32-t-gpr-cmd-alloc-send-gpr-cmd-alloc-send-t-args" title="Permalink to this heading"></a></h4>
<p>Allocates and sends a formatted free packet.</p>
<p><strong>Associated data types</strong></p>
<p><a class="reference external" href="#struct-gpr-cmd-alloc-send-t">gpr_cmd_alloc_send_t</a></p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>args</em></p></td>
<td><p>Pointer to the allocated packet information, such as domain and</p>
<p>port IDs, token and opcode values, and payload size.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This helper function fully creates the packet, and it performs the
packet allocation and initialization. The caller supplies the packet
payload as an input if you do not want to it use up front. For
comparison, see
<a class="reference external" href="#static-uint32-t-gpr-cmd-async-send-gpr-packet-t-packet">gpr_cmd_async_send()</a>.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.
The source and destination services must be registered with the GPR.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_inline.h&quot;</span>

<span class="kt">int32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="n">gpr_packet_t</span><span class="o">*</span><span class="w"> </span><span class="n">packet_ptr</span><span class="p">;</span>
<span class="kt">uint32_t</span><span class="w"> </span><span class="n">payload_size</span><span class="p">;</span>

<span class="c1">//Example payload required to be sent.</span>
<span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="n">payload</span><span class="p">;</span>

<span class="c1">// Fill in the payload.</span>
<span class="n">payload</span><span class="p">.</span><span class="n">param1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">payload</span><span class="p">.</span><span class="n">param2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="n">gpr_cmd_alloc_send_t</span><span class="w"> </span><span class="n">alloc_send_args</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">src_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_SOURCE</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">src_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_SOURCE</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">dst_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_DOMAIN_ID_DESTINATION</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">dst_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_CLIENT_SERVICE_PORT_ID_DESTINATION</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x12345678</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">opcode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TEST_CLIENT_CMD_FUNCTION</span><span class="p">;</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">payload_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="w"> </span><span class="n">test_client_cmd_function_t</span><span class="w"> </span><span class="p">);</span>
<span class="n">alloc_send_args</span><span class="p">.</span><span class="n">payload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">payload</span><span class="p">;</span>

<span class="c1">// Create and send packet.</span>
<span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">__gpr_cmd_alloc_send</span><span class="p">(</span><span class="n">alloc_send_args</span><span class="p">);</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Packet allocation and send failed&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">AR_EFAILED</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="struct-gpr-cmd-alloc-send-t">
<h4>struct gpr_cmd_alloc_send_t<a class="headerlink" href="#struct-gpr-cmd-alloc-send-t" title="Permalink to this heading"></a></h4>
<p>Contains the allocated packet information for <a class="reference external" href="#static-uint32-t-gpr-cmd-alloc-send-gpr-cmd-alloc-send-t-args">gpr_cmd_alloc_send()</a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>src_domain_id</p></td>
<td><p>Domain ID of the sender service.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>src_port</p></td>
<td><p>Registered unique ID of the sender service.</p></td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>dst_domain_id</p></td>
<td><p>Domain ID of the receiver service.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>dst_port</p></td>
<td><p>Registered unique ID of the receiver service.</p></td>
</tr>
<tr class="row-even"><td><p>uint8_t</p></td>
<td><p>client_data</p></td>
<td><p>Reserved for use by the client.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>token</p></td>
<td><p>Value attached by the sender to determine when command messages</p>
<p>have been processed by the receiver after having received response messages.</p>
</td>
</tr>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>opcode</p></td>
<td><p>Operation code defines both the action and the payload structure to</p>
<p>the receiver.</p>
</td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>payload_size</p></td>
<td><p>Actual number of bytes needed for the payload.</p></td>
</tr>
<tr class="row-even"><td><p>void ∗</p></td>
<td><p>payload</p></td>
<td><p>Pointer to the payload to send.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="accept-a-command-message">
<h2><a class="toc-backref" href="#id71" role="doc-backlink">Accept a Command Message</a><a class="headerlink" href="#accept-a-command-message" title="Permalink to this heading"></a></h2>
<section id="id17">
<h3><a class="toc-backref" href="#id72" role="doc-backlink">Function Documentation</a><a class="headerlink" href="#id17" title="Permalink to this heading"></a></h3>
<section id="static-uint32-t-gpr-cmd-accept-command-gpr-packet-t-packet">
<h4>static uint32_t gpr_cmd_accept_command (gpr_packet_t *packet)<a class="headerlink" href="#static-uint32-t-gpr-cmd-accept-command-gpr-packet-t-packet" title="Permalink to this heading"></a></h4>
<p>Accepts a command packet by replying with a
<a class="reference external" href="#define-gpr-ibasic-evt-accepted-0x02001006">GPR_IBASIC_EVT_ACCEPTED</a>
message to the sender.</p>
<p><strong>Associated data types</strong></p>
<p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>packet</em></p></td>
<td><p>Pointer to the command packet to be accepted.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>The required routing information is extracted from the specified
packet.
The same procedure can be performed manually by swapping the source
and destination fields, and then inserting a
GPR_IBASIC_EVT_ACCEPTED payload.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.
The source and destination services must be registered with the GPR.</p>
<p><strong>Code example</strong></p>
<p>See the code example for
<a class="reference external" href="#static-uint32-t-gpr-cmd-register-uint32-t-src-port-gpr-callback-fn-t-void-callback-data">gpr_cmd_register()</a>.</p>
</section>
</section>
</section>
<section id="send-a-command-response">
<h2><a class="toc-backref" href="#id73" role="doc-backlink">Send a Command Response</a><a class="headerlink" href="#send-a-command-response" title="Permalink to this heading"></a></h2>
<section id="id18">
<h3><a class="toc-backref" href="#id74" role="doc-backlink">Function Documentation</a><a class="headerlink" href="#id18" title="Permalink to this heading"></a></h3>
<section id="static-uint32-t-gpr-cmd-end-command-gpr-packet-t-packet-uint32-t-status">
<h4>static uint32_t gpr_cmd_end_command ( gpr_packet_t *packet, uint32_t status )<a class="headerlink" href="#static-uint32-t-gpr-cmd-end-command-gpr-packet-t-packet-uint32-t-status" title="Permalink to this heading"></a></h4>
<p>Completes a command message by replying with a
<a class="reference external" href="#define-gpr-ibasic-rsp-result-0x02001005">GPR_IBASIC_RSP_RESULT</a>
command response message to the sender. The indicated packet is then
freed.</p>
<p><strong>Associated data types</strong></p>
<p><a class="reference external" href="#struct-gpr-packet-t">gpr_packet_t</a></p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>packet</em></p></th>
<th class="head"><p>Pointer to the command message to complete.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>status</em></p></td>
<td><p>Completion or error status to respond to the client (see</p>
<p>Section <a class="reference internal" href="#gpr-status-and-error-codes"><span class="std std-ref">GPR Status and Error Codes</span></a>).</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function both sends an GPR_IBASIC_RSP_RESULT command
response back to the sender and frees the specified command packet.
The required routing information is extracted from the command
packet.
The same procedure can be done manually by swapping the source and
destination fields and then inserting an
<a class="reference external" href="#define-gpr-ibasic-rsp-result-0x02001005">GPR_IBASIC_RSP_RESULT</a>
command response payload.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.
<a class="reference external" href="#define-ar-ebadparam-2">AR_EBADPARAM</a> – When the input
parameter is invalid. The packet to be delivered is not freed.</p>
<p><strong>Dependencies</strong></p>
<p>GPR initialization must be completed via
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a>.
The source and destination services must be registered with the GPR.</p>
<p><strong>Code example</strong></p>
<p>See the code example for
<a class="reference external" href="#static-uint32-t-gpr-cmd-register-uint32-t-src-port-gpr-callback-fn-t-void-callback-data">gpr_cmd_register()</a>.</p>
</section>
</section>
<section id="gpr-standard-response-opcodes">
<h3><a class="toc-backref" href="#id75" role="doc-backlink">GPR Standard Response Opcodes</a><a class="headerlink" href="#gpr-standard-response-opcodes" title="Permalink to this heading"></a></h3>
<section id="id19">
<h4>Define Documentation<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h4>
</section>
<section id="define-gpr-ibasic-rsp-result-0x02001005">
<h4>#define GPR_IBASIC_RSP_RESULT ( 0x02001005 )<a class="headerlink" href="#define-gpr-ibasic-rsp-result-0x02001005" title="Permalink to this heading"></a></h4>
<p>Response message opcode that indicates a command has completed. All
services and clients must handle this response opcode.</p>
<p><strong>Payload (gpr_ibasic_rsp_result_t)</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>opcode</p></td>
<td><p>Command operation code that completed.</p></td>
</tr>
<tr class="row-odd"><td><p>uint32_t</p></td>
<td><p>status</p></td>
<td><p>Completion status (see Section <a class="reference internal" href="#gpr-status-and-error-codes"><span class="std std-ref">GPR Status and Error Codes</span></a>).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="define-gpr-ibasic-evt-accepted-0x02001006">
<h4>#define GPR_IBASIC_EVT_ACCEPTED ( 0x02001006 )<a class="headerlink" href="#define-gpr-ibasic-evt-accepted-0x02001006" title="Permalink to this heading"></a></h4>
<p>Standard message opcode that indicates a command was accepted.
The generation and processing of this event is optional. Clients
that do not understand this event must drop it by freeing the
received packet.</p>
<p><strong>Payload (gpr_ibasic_evt_accepted_t)</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint32_t</p></td>
<td><p>opcode</p></td>
<td><p>Operation code of the command that was accepted.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="ipc-interfaces">
<h2><a class="toc-backref" href="#id76" role="doc-backlink">IPC Interfaces</a><a class="headerlink" href="#ipc-interfaces" title="Permalink to this heading"></a></h2>
<section id="gpr-to-ipc-callback-functions">
<span id="id20"></span><h3><a class="toc-backref" href="#id77" role="doc-backlink">GPR-to-IPC Callback Functions</a><a class="headerlink" href="#gpr-to-ipc-callback-functions" title="Permalink to this heading"></a></h3>
<p>To enable remote communication, both the GPR and IPC data link
layers must implement and exchange callback functions during
initialization.</p>
<section id="id21">
<h4>Data Structure Documentation<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h4>
</section>
<section id="struct-gpr-to-ipc-vtbl-t">
<h4>struct gpr_to_ipc_vtbl_t<a class="headerlink" href="#struct-gpr-to-ipc-vtbl-t" title="Permalink to this heading"></a></h4>
<p>Table of callback functions exposed by the GPR to the IPC data link
layers. The GPR sends this table to the data link layers during data
link layer initialization.</p>
<p><strong>Data Fields</strong></p>
<ul class="simple">
<li><p>uint32_t(∗ <a class="reference external" href="#-bookmark202">receive</a> )(void ∗buf, uint32_t
length)</p></li>
<li><p>uint32_t(∗ <a class="reference external" href="#-bookmark203">send_done</a> )(void ∗buf, uint32_t
length)</p></li>
</ul>
<p><strong>Field Documentation</strong></p>
<p><strong>uint32_t(* gpr_to_ipc_vtbl_t::receive)(void* buf, uint32_t length)</strong></p>
<p>Prototype of the receive() callback function for the GPR.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>buf</em></p></th>
<th class="head"><p>Pointer to the packet.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>length</em></p></td>
<td><p>Size of the packet.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>When the data link layer receives a packet, it calls this GPR
function to handle and route the packet to its final destination.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>uint32_t(*gpr_to_ipc_vtbl_t::send_done)(void *buf, uint32_t length)</strong></p>
<p>Prototype of the send_done() callback function for the GPR.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>buf</em></p></th>
<th class="head"><p>Pointer to the packet.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>length</em></p></td>
<td><p>Size of the packet.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>When the data link layer finishes sending a packet, it uses this
function to signal the GPR to free the packet.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
</section>
</section>
<section id="ipc-to-gpr-virtual-function-wrapper">
<span id="id22"></span><h3><a class="toc-backref" href="#id78" role="doc-backlink">IPC-to-GPR Virtual Function Wrapper</a><a class="headerlink" href="#ipc-to-gpr-virtual-function-wrapper" title="Permalink to this heading"></a></h3>
<p>To enable remote communication, both the GPR and IPC data link
layers must implement and exchange callback functions during
initialization time.</p>
<section id="id23">
<h4>Data Structure Documentation<a class="headerlink" href="#id23" title="Permalink to this heading"></a></h4>
</section>
<section id="struct-ipc-to-gpr-vtbl-t">
<h4>struct ipc_to_gpr_vtbl_t<a class="headerlink" href="#struct-ipc-to-gpr-vtbl-t" title="Permalink to this heading"></a></h4>
<p>Table of functions exposed by data link layers to the GPR. The
functions must be populated by every data link layer when
<a class="reference external" href="#gpr-external-uint32-t-gpr-init-void">gpr_init()</a> calls for
data link layer initialization.</p>
<p><strong>Data Fields</strong></p>
<ul class="simple">
<li><p>uint32_t(∗ <a class="reference external" href="#-bookmark207">send</a> )(uint32_t domain_id, void
∗buf, uint32_t length)</p></li>
<li><p>uint32_t(∗ <a class="reference external" href="#-bookmark208">receive_done</a> )(uint32_t domain_id,
void ∗buf)</p></li>
</ul>
<p><strong>Field Documentation</strong></p>
<p><strong>uint32_t(*ipc_to_gpr_vtbl_t::send)(uint32_t domain_id, void *buf, uint32_t length)</strong></p>
<p>Prototype of the send() function for a data link layer.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>domain_id</em></p></th>
<th class="head"><p>ID of the domain to which packet is being sent.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>buf</em></p></td>
<td><p>Pointer to the packet.</p></td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>length</em></p></td>
<td><p>Size of the packet.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>When the GPR sends a packet to a destination domain, it calls this
function of the corresponding data link layer.</p>
<p><strong>Returns</strong></p>
<blockquote>
<div><p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
</div></blockquote>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>uint32_t(*ipc_to_gpr_vtbl_t::receive_done)(uint32_t domain_id, void *buf)</strong></p>
<p>Prototype of the receive_done() function for a data link layer.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>domain_id</em></p></th>
<th class="head"><p>ID of the domain from which packet was sent.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>buf</em></p></td>
<td><p>Pointer to the packet.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>When the GPR finishes processing a packet it received from the data
link layer, it returns the packet to the data link layer for it to
free the buffer.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
</section>
</section>
<section id="ipc-data-link-function-prototypes">
<span id="id24"></span><h3><a class="toc-backref" href="#id79" role="doc-backlink">IPC Data Link Function Prototypes</a><a class="headerlink" href="#ipc-data-link-function-prototypes" title="Permalink to this heading"></a></h3>
<p>A data link layer is used for two-way communication between a given
source domain and a destination domain. The source domain can set up
communication with multiple destination domains through different
data link layers.
This section outlines the function prototypes used for
initialization and de-initialization of any data link layer.</p>
<section id="id25">
<h4>Typedef Documentation<a class="headerlink" href="#id25" title="Permalink to this heading"></a></h4>
</section>
<section id="typedef-uint32-t-ipc-dl-init-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl">
<h4>typedef uint32_t(∗ ipc_dl_init_fn_t)(uint32_t src_domain_id, uint32_t dest_domain_id, const gpr_to_ipc_vtbl_t *p_gpr_to_ipc_vtbl, ipc_to_gpr_vtbl_t **pp_ipc_to_gpr_vtbl)<a class="headerlink" href="#typedef-uint32-t-ipc-dl-init-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl" title="Permalink to this heading"></a></h4>
<p>Initializes a data link or IPC layer that communicates between two
domains.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-to-ipc-vtbl-t">gpr_to_ipc_vtbl_t</a>
<a class="reference external" href="#struct-ipc-to-gpr-vtbl-t">ipc_to_gpr_vtbl_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>src_domain_id</em></p></th>
<th class="head"><p>Domain ID of the source.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>dest_domain_id</em></p></td>
<td><p>Domain ID of the destination with which the given</p>
<p>src_domain_id is to establish communication.</p>
</td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>p_gpr_to_ipc_vtbl</em></p></td>
<td><p>Pointer to the function table that contains the callback functions</p>
<p>the GPR provides to each IPC data link layer during initialization.</p>
<p>This function table argument is defined as a constant because the</p>
<p>same GPR callback functions are sent to each data link layer.</p>
</td>
</tr>
<tr class="row-even"><td><p>out</p></td>
<td><p><em>pp_ipc_to_gpr_vtbl</em></p></td>
<td><p>Double pointer to the function table that contains the functions</p>
<p>each IPC data link layer provides to the GPR. It is populated by</p>
<p>each data link during initialization.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function is called for each data link layer during GPR
initialization. It sets up all the necessary function handlers to
receive and send packets in the GPR and data link layers.
The GPR registers callback functions to each data link layer, and in
turn, a data link layer registers its callback functions with the
GPR.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>

<span class="c1">//Example of initializing a datalink layer to communicate between</span>
<span class="c1">// two domains - ADSP and APPS.</span>

<span class="c1">//Datalink layer entry point function.</span>
<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_datalink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="w">   </span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="c1">//Functions are defined in gpr.</span>
<span class="k">static</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="n">gpr_to_datalink_vtbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">gpr_receive</span><span class="p">,</span>
<span class="w">                                                 </span><span class="n">gpr_send_done</span><span class="p">,</span>
<span class="w">                                                </span><span class="p">};</span>

<span class="c1">//Functions are defined inside the datalink layer and to be populated and</span>
<span class="c1">//sent back to gpr in the ipc_datalink_init function.</span>
<span class="k">static</span><span class="w"> </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="n">datalink_layer_to_gpr_vtbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">datalink_send</span><span class="p">,</span>
<span class="w">                                                       </span><span class="n">datalink_receive_done</span><span class="p">,</span>
<span class="w">                                                      </span><span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">;</span>
<span class="w">   </span><span class="n">uin32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_IDS_DOMAIN_ID_APPS_V</span><span class="p">;</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipc_datalink_init</span><span class="p">(</span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                          </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                          </span><span class="o">&amp;</span><span class="n">gpr_to_datalink_vtbl</span><span class="p">,</span>
<span class="w">                          </span><span class="o">&amp;</span><span class="n">datalink_layer_to_gpr_vtbl</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">AR_MSG</span><span class="p">(</span><span class="n">DBG_ERROR_PRIO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Initialization failed for destination domain id %lu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="typedef-uint32-t-ipc-dl-deinit-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id">
<h4>typedef uint32_t(∗ ipc_dl_deinit_fn_t)(uint32_t src_domain_id, uint32_t dest_domain_id)<a class="headerlink" href="#typedef-uint32-t-ipc-dl-deinit-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id" title="Permalink to this heading"></a></h4>
<p>Deinitializes a data link or IPC layer that was set up to
communicate between two domains.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>src_domain_id</em></p></th>
<th class="head"><p>Domain ID of the source.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>dest_domain_id</em></p></td>
<td><p>Domain ID of the destination with which the src_domain_id</p>
<p>must close communication.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function is called for each data link layer during GPR
deinitialization.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>

<span class="c1">//Example of deinitializing a datalink layer to close communication between</span>
<span class="c1">//two domains - ADSP and APPS.</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_datalink_deinit</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                           </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">;</span>
<span class="w">   </span><span class="n">uin32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GPR_IDS_DOMAIN_ID_APPS_V</span><span class="p">;</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ipc_datalink_deinit</span><span class="p">(</span><span class="n">src_domain_id</span><span class="p">,</span><span class="n">dest_domain_id</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">AR_MSG</span><span class="p">(</span><span class="n">DBG_ERROR_PRIO</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Deinitialization failed for destination domain id %lu&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="gpr-functions-for-local-routing">
<h3><a class="toc-backref" href="#id80" role="doc-backlink">GPR Functions for Local Routing</a><a class="headerlink" href="#gpr-functions-for-local-routing" title="Permalink to this heading"></a></h3>
<p>GPR functions used for local routing, which is routing between two
services on the same domain, should also follow IPC data link
function prototype (see Section
<a class="reference internal" href="#ipc-data-link-function-prototypes"><span class="std std-ref">IPC Data Link Function Prototypes</span></a>).</p>
<section id="id26">
<h4>Function Documentation<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h4>
<section id="gpr-external-uint32-t-ipc-dl-local-init-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl">
<h5>GPR_EXTERNAL uint32_t ipc_dl_local_init ( uint32_t src_domain_id, uint32_t dest_domain_id, const gpr_to_ipc_vtbl_t *p_gpr_to_ipc_vtbl, ipc_to_gpr_vtbl_t **pp_ipc_to_gpr_vtbl )<a class="headerlink" href="#gpr-external-uint32-t-ipc-dl-local-init-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl" title="Permalink to this heading"></a></h5>
<p>Performs initialization of the GPR functionality used for local
routing of packets.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-gpr-to-ipc-vtbl-t">gpr_to_ipc_vtbl_t</a>
<a class="reference external" href="#struct-ipc-to-gpr-vtbl-t">ipc_to_gpr_vtbl_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>src_domain_id</em></p></th>
<th class="head"><p>Domain ID for the source.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>dest_domain_id</em></p></td>
<td><p>Domain ID for the destination.</p></td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>p_gpr_to_ipc_vtbl</em></p></td>
<td><p>Pointer to the GPR-to-IPC virtual function table.</p></td>
</tr>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>pp_ipc_to_gpr_vtbl</em></p></td>
<td><p>Double pointer to the IPC-to-GPR virtual function table.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function is of type
<a class="reference external" href="#typedef-uint32-t-ipc-dl-init-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl">ipc_dl_init_fn_t()</a>.
It sets up the GPR for transferring and receiving packets within the
same domain or processor, when there is no need for a data link
layer.
This function must be specified as the initialization function for
the local or host domain in the array of type
<a class="reference external" href="#struct-ipc-dl-t">ipc_dl_t</a> in the platform-specific
configuration wrappers (see Section
<a class="reference internal" href="#platform-specific-configuration-wrappers"><span class="std std-ref">Platform-specific Configuration Wrappers</span></a>).</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<blockquote>
<div><p>See the code example for
<a class="reference external" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">gpr_drv_internal_init()</a>.</p>
</div></blockquote>
<p><strong>GPR_EXTERNAL uint32_t ipc_dl_local_deinit ( uint32_t src_domain_id, uint32_t dest_domain_id )</strong></p>
<p>Performs deinitialization of the GPR functionality used for local routing of packets.</p>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>src_domain_id</em></p></th>
<th class="head"><p>Domain ID for the source.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>dest_domain_id</em></p></td>
<td><p>Domain ID for the destination.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function is of type
<a class="reference external" href="#typedef-uint32-t-ipc-dl-deinit-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id">ipc_dl_deinit_fn_t()</a>.
It deinitializes the GPR for transferring and receiving packets
within the same domain or processor.
This function must be specified as the initialization function for
the local or host domain in the array of type
<a class="reference external" href="#struct-ipc-dl-t">ipc_dl_t</a> in the platform-specific
configuration wrappers (see Section
<a class="reference internal" href="#platform-specific-configuration-wrappers"><span class="std std-ref">Platform-specific Configuration Wrappers</span></a>).</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<p>See the code example for
<a class="reference external" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">gpr_drv_internal_init()</a>.</p>
</section>
</section>
</section>
<section id="platform-specific-configuration-wrappers">
<span id="id27"></span><h3><a class="toc-backref" href="#id81" role="doc-backlink">Platform-specific Configuration Wrappers</a><a class="headerlink" href="#platform-specific-configuration-wrappers" title="Permalink to this heading"></a></h3>
<p>The platform-specific configuration wrappers allow each platform to
provide specific configuration and perform GPR instantiation with
this configuration. GPR instantiation is done by calling
<a class="reference external" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">gpr_drv_internal_init()</a>.
The platform wrapper provides control over the following aspects.</p>
<ul class="simple">
<li><p>Number and size of GPR packets to be allocated by the GPR instance on
this platform. The GPR currently supports creation and maintenance of
two such packet pools.</p></li>
<li><p>Domains with which the current platform or domain wants to establish
communication with and the corresponding data link layer to be used.</p></li>
<li><p>This information is provided through the gpr_ipc_dl_table (see
<a class="reference external" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">gpr_drv_internal_init()</a>), which has multiple
entries, each of type <a class="reference external" href="#struct-ipc-dl-t">ipc_dl_t</a>.</p></li>
<li><p>The gpr_ipc_dl_table has as many entries as the domain IDs with
which the given processor is to establish communication.</p></li>
<li><p>The maximum size of the table is the maximum number of processor
domains that are present.</p></li>
</ul>
<section id="id28">
<h4>Data Structure Documentation<a class="headerlink" href="#id28" title="Permalink to this heading"></a></h4>
<section id="struct-ipc-dl-t">
<h5>struct ipc_dl_t<a class="headerlink" href="#struct-ipc-dl-t" title="Permalink to this heading"></a></h5>
<p>Contains the domain ID to which communication is to be established
through a specified IPC data link layer. This structure includes the
corresponding data link initialization and deinitialization
functions to be called.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>uint16_t</p></td>
<td><p>domain_id</p></td>
<td><p>Domain ID to establish communication with.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="#typedef-uint32-t-ipc-dl-init-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id-const-gpr-to-ipc-vtbl-t-p-gpr-to-ipc-vtbl-ipc-to-gpr-vtbl-t-pp-ipc-to-gpr-vtbl">ipc_dl_init_fn_t</a></p></td>
<td><p>init_fn</p></td>
<td><p>Initialization function in the IPC data link layer.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="#typedef-uint32-t-ipc-dl-deinit-fn-t-uint32-t-src-domain-id-uint32-t-dest-domain-id">ipc_dl_deinit_fn_t</a></p></td>
<td><p>deinit_fn</p></td>
<td><p>Deinitialization function in the IPC data link layer.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id29">
<h4>Function Documentation<a class="headerlink" href="#id29" title="Permalink to this heading"></a></h4>
<section id="gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2">
<span id="gpr-drv-internal-init"></span><h5>GPR_EXTERNAL uint32_t gpr_drv_internal_init ( struct ipc_dl_t gpr_ipc_dl_table[ ], uint32_t num_domains, uint32_t default_domain_id, uint32_t buf_size_1, uint32_t num_packets_1, uint32_t buf_size_2, uint32_t num_packets_2 )<a class="headerlink" href="#gpr-external-uint32-t-gpr-drv-internal-init-struct-ipc-dl-t-gpr-ipc-dl-table-uint32-t-num-domains-uint32-t-default-domain-id-uint32-t-buf-size-1-uint32-t-num-packets-1-uint32-t-buf-size-2-uint32-t-num-packets-2" title="Permalink to this heading"></a></h5>
<p>Performs internal initialization of the GPR infrastructure.</p>
<p><strong>Associated data types</strong></p>
<blockquote>
<div><p><a class="reference external" href="#struct-ipc-dl-t">ipc_dl_t</a></p>
</div></blockquote>
<p><strong>Parameters</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>in</p></th>
<th class="head"><p><em>gpr_ipc_dl_table</em></p></th>
<th class="head"><p>Array of domain IDs to which communication is to be</p>
<p>established.</p>
</th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>num_domains</em></p></td>
<td><p>Number of domain IDs in the array.</p></td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>default_domain_id</em></p></td>
<td><p>Host domain ID.</p></td>
</tr>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>buf_size_1</em></p></td>
<td><p>Size (in bytes) of each packet to be created in the first packet</p>
<p>pool.</p>
</td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>num_packets_1</em></p></td>
<td><p>Number of packets of size buf_size_1 to be created.</p></td>
</tr>
<tr class="row-even"><td><p>in</p></td>
<td><p><em>buf_size_2</em></p></td>
<td><p>Size (in bytes) of each packet to be created in the second packet</p>
<p>pool.</p>
</td>
</tr>
<tr class="row-odd"><td><p>in</p></td>
<td><p><em>num_packets_2</em></p></td>
<td><p>Number of packets of size buf_size_2 to be created.</p></td>
</tr>
</tbody>
</table>
<p><strong>Detailed description</strong></p>
<p>This function must be called from all platform wrappers to perform
GPR internal initialization, which sets up the entire GPR
functionality.</p>
<p><strong>Returns</strong></p>
<p><a class="reference external" href="#define-ar-eok-0">AR_EOK</a> – When successful.</p>
<p><strong>Dependencies</strong></p>
<p>None.</p>
<p><strong>Code example</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">//Example platform wrapper for GPR in ADSP domain.</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_i.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_glink.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_custom_dl.h&quot;</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="w">   </span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w">                </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="w">   </span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                           </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_custom_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w">                </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">                 </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="w">   </span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_custom_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                           </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="c1">//This example creates the following gpr packet pools:</span>
<span class="c1">// 100 packets of size 512 bytes and 4 packets of size 4096 bytes.</span>
<span class="cp">#define GPR_NUM_PACKETS_1 ( 100 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_1 ( 512 )</span>
<span class="cp">#define GPR_NUM_PACKETS_2 ( 4 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_2 ( 4096 )</span>

<span class="c1">//In this example, ADSP wants to open communication with MODEM domain(through custom datalink layer),</span>
<span class="c1">//with APPS domain (through glink datalink layer) as well as</span>
<span class="c1">//set up local transmission of packets within the same domain.</span>

<span class="c1">//Thus the GPR IPC table has four entries, two for each domain and one for the local domain</span>
<span class="c1">//containing initialization, deinitialization functions for each of their datalink layers.</span>
<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ipc_dl_t</span><span class="w">  </span><span class="n">gpr_adsp_ipc_dl_table</span><span class="p">[</span><span class="n">GPR_PL_NUM_TOTAL_DOMAINS_V</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_MODEM_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_custom_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_custom_deinit</span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">},</span>
<span class="w">         </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_APPS_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">}};</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">gpr_drv_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_domains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gpr_adsp_ipc_dl_table</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ipc_dl_t</span><span class="p">);</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_drv_internal_init</span><span class="p">(</span><span class="n">gpr_adsp_ipc_dl_table</span><span class="p">,</span>
<span class="w">                              </span><span class="n">num_domains</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span><span class="w"> </span><span class="c1">//host_domain_id</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_2</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_2</span><span class="p">);</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not initialize the GPR infrastructure and datalink layers&quot;</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="custom-implementations">
<h2><a class="toc-backref" href="#id82" role="doc-backlink">Custom Implementations</a><a class="headerlink" href="#custom-implementations" title="Permalink to this heading"></a></h2>
<p>Customize the GPR protocol by following the basic guidelines
outlined in this chapter. Custom implementations include adding a
custom domain ID, a custom platform wrapper, or a custom data link
layer.</p>
<section id="custom-platform-wrapper">
<span id="gpr-custom-platform-wrapper"></span><h3><a class="toc-backref" href="#id83" role="doc-backlink">Custom Platform Wrapper</a><a class="headerlink" href="#custom-platform-wrapper" title="Permalink to this heading"></a></h3>
<p>A custom platform wrapper allows control of the following:</p>
<ul>
<li><p>The number of packets and size of packets the GPR is to allocate.</p></li>
<li><p>Which domains a given domain is to open communication with.</p></li>
<li><p>Which corresponding data link or transport layers the given domain is
to use for communication. Thus, platform wrappers vary depending on
the host domain or platform (see Section
<a class="reference internal" href="#platform-specific-configuration-wrappers"><span class="std std-ref">Platform-specific Configuration Wrappers</span></a>).</p>
<blockquote>
<div><p>You can also have multiple custom wrappers for the same domain,
depending on which chipset or use case the GPR must be initialized
for. The wrapper is picked up by the underlying build system at
compile time.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="custom-domain-id">
<span id="gpr-custom-domain-id"></span><h3><a class="toc-backref" href="#id84" role="doc-backlink">Custom Domain ID</a><a class="headerlink" href="#custom-domain-id" title="Permalink to this heading"></a></h3>
<p>Add a custom or new domain ID by expanding the list of existing
domain IDs in the API file, gpr_domain_ids.h (see Section
<a class="reference internal" href="#gpr-contants-and-macros"><span class="std std-ref">GPR Constants and Macros</span></a>). Update the GPR_PL_MAX_DOMAIN_ID_V and
GPR_PL_NUM_TOTAL_DOMAINS_V macros to reflect the new maximum
domain ID and the total number of domain IDs respectively.
Following are two updates that are required to ensure packet
transmission to and from this custom domain.</p>
<section id="for-gpr-on-a-custom-domain-or-processor">
<h4>For GPR on a Custom Domain or Processor<a class="headerlink" href="#for-gpr-on-a-custom-domain-or-processor" title="Permalink to this heading"></a></h4>
<p>Add a new platform wrapper file that specifies the GPR packet pool
information and the IPC data link function table, depending on which
processing domains the host domain is to communicate with.
In the IPC data link function table, the entry that corresponds to
the custom domain must include the local GPR routing initialization
and deinitialization functions.</p>
<p><strong>Code example of a GPR platform wrapper in a custom domain</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Example platform wrapper for GPR in Custom domain.</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_i.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_glink.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_custom_dl.h&quot;</span>

<span class="c1">//Custom domain ID</span>
<span class="cp">#define GPR_IDS_DOMAIN_ID_CUSTOM_V (0x7)</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_custom_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                          </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w">   </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_custom_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                            </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="c1">// Custom domain wants to create 50 gpr packets of size 256 bytes and 4 packets of size 4096 bytes.</span>
<span class="cp">#define GPR_NUM_PACKETS_1 ( 50 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_1 ( 256 )</span>
<span class="cp">#define GPR_NUM_PACKETS_2 ( 4 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_2 ( 4096 )</span>

<span class="cm">/* In this example, Custom Domain wants to open communication with ADSP domain (through Glink</span>
<span class="cm">datalink layer), open communication with MODEM domain(through custom datalink layer) as well</span>
<span class="cm">as set up local transmission of packets within the same domain.</span>
<span class="cm">The GPR IPC table has three entries, two for each of the remote domains and one for the local</span>
<span class="cm">domain. Each entry contains initialization, deinitialization functions for each of their</span>
<span class="cm">datalink layers. */</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ipc_dl_t</span><span class="w"> </span><span class="n">gpr_custom_domain_ipc_dl_table</span><span class="p">[</span><span class="n">GPR_PL_NUM_TOTAL_DOMAINS_V</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_MODEM_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_custom_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_custom_deinit</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_CUSTOM_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">}</span>
<span class="p">};</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">gpr_drv_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_domains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gpr_custom_domain_ipc_dl_table</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ipc_dl_t</span><span class="p">);</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_drv_internal_init</span><span class="p">(</span><span class="n">gpr_custom_domain_ipc_dl_table</span><span class="p">,</span>
<span class="w">                              </span><span class="n">num_domains</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_IDS_DOMAIN_ID_CUSTOM_V</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_2</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_2</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not initialize the GPR infrastructure on Custom&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="for-gpr-on-another-domain-or-processor">
<h4>For GPR on Another Domain or Processor<a class="headerlink" href="#for-gpr-on-another-domain-or-processor" title="Permalink to this heading"></a></h4>
<p>Update the platform wrapper for all other domains that are to
communicate with the custom domain. Add an entry for this custom
domain to the existing IPC data link function table. This entry is
of type ipc_dl_t, and it specifies the custom domain ID along with
the IPC data link layer initialization and deinitialization
functions.</p>
<p><strong>Code example of a GPR platform wrapper on another domain opening a
link to the custom domain</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Example platform wrapper for GPR in ADSP domain.</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_i.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_glink.h&quot;</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>


<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="c1">// ADSP domain wants to create 100 GPR packets of size 512 bytes and 4 packets of size 4096 bytes.</span>

<span class="cp">#define GPR_NUM_PACKETS_1 ( 100 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_1 ( 512 )</span>
<span class="cp">#define GPR_NUM_PACKETS_2 ( 4 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_2 ( 4096 )</span>

<span class="cm">/* In this example,</span>
<span class="cm">ADSP domain wants to open communication with Custom domain (through Glink datalink layer)</span>
<span class="cm">as well as set up local transmission of packets within the same domain.</span>
<span class="cm">The GPR IPC table has three entries, two for each of the remote domains and one for the</span>
<span class="cm">local domain. Each entry contains initialization, deinitialization functions for each of</span>
<span class="cm">their datalink layers. */</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ipc_dl_t</span><span class="w"> </span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">[</span><span class="n">GPR_PL_NUM_TOTAL_DOMAINS_V</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_CUSTOM_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">}</span>
<span class="p">};</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">gpr_drv_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_domains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ipc_dl_t</span><span class="p">);</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_drv_internal_init</span><span class="p">(</span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">,</span>
<span class="w">                              </span><span class="n">num_domains</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_2</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_2</span><span class="p">);</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not initialize the GPR infrastructure on ADSP&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="custom-ipc-data-link-or-transport-layer">
<span id="gpr-custom-ipc-data-link"></span><h3><a class="toc-backref" href="#id85" role="doc-backlink">Custom IPC Data Link or Transport Layer</a><a class="headerlink" href="#custom-ipc-data-link-or-transport-layer" title="Permalink to this heading"></a></h3>
<p>To communicate through custom data link layers, the GPR on both
domains is to implement a custom IPC data link as follows:</p>
<ol class="arabic simple">
<li><p>Implement IPC data link initialization and deinitialization
functions.</p></li>
<li><p>Add these functions to the corresponding entries in the IPC data link
function table in the platform wrapper.</p></li>
<li><p>Implement the IPC data link-to-GPR callback functions (ipc_dl_t)
and share them with the GPR. This step includes the receive_done()
and send() functions.</p></li>
<li><p>Store the GPR-to-IPC data link callback functions (ipc_dl_t) in the
data link layer during initialization.</p></li>
</ol>
<p>This step includes the receive() and send_done() functions.</p>
<p><strong>Code example of platform wrapper using custom data link layer</strong></p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Example platform wrapper for GPR in ADSP domain.</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ipc_dl_api.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_api_i.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_glink.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gpr_custom_datalink.h&quot;</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="c1">//Custom datalink initialization and deintialization functions</span>
<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_custom_datalink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                               </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                               </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                               </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_custom_datalink_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                                 </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="kt">uint32_t</span><span class="w">  </span><span class="n">dest_domain_id</span><span class="p">,</span>
<span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">gpr_to_ipc_vtbl_t</span><span class="w"> </span><span class="o">*</span><span class="n">p_gpr_to_ipc_vtbl</span><span class="p">,</span>
<span class="w">                                        </span><span class="n">ipc_to_gpr_vtbl_t</span><span class="w"> </span><span class="o">**</span><span class="n">pp_ipc_to_gpr_vtbl</span><span class="p">);</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">src_domain_id</span><span class="p">,</span>
<span class="w">                                          </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">dest_domain_id</span><span class="p">);</span>

<span class="c1">// ADSP wants to create 100 gpr packets of size 512 bytes and 4 packets of size 4096 bytes.</span>
<span class="cp">#define GPR_NUM_PACKETS_1 ( 100 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_1 ( 512 )</span>
<span class="cp">#define GPR_NUM_PACKETS_2 ( 4 )</span>
<span class="cp">#define GPR_DRV_BYTES_PER_PACKET_2 ( 4096 )</span>

<span class="cm">/* In this example, ADSP Domain wants to open communication with APPS domain (through Glink),</span>
<span class="cm">open communication with MODEM domain(through custom datalink layer) as well as set up local</span>
<span class="cm">transmission of packets within the same domain.</span>
<span class="cm">The GPR IPC table has three entries, two for each of the remote domains and one for the local</span>
<span class="cm">domain. Each entry contains initialization, deinitialization functions for each of their</span>
<span class="cm">datalink layers. */</span>

<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">ipc_dl_t</span><span class="w"> </span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">[</span><span class="n">GPR_PL_NUM_TOTAL_DOMAINS_V</span><span class="p">]</span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_local_deinit</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_MODEM_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_custom_datalink_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_custom_datalink_deinit</span><span class="p">},</span>
<span class="w">   </span><span class="p">{</span><span class="n">GPR_IDS_DOMAIN_ID_APPS_V</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_init</span><span class="p">,</span><span class="w"> </span><span class="n">ipc_dl_glink_deinit</span><span class="p">}</span>
<span class="p">};</span>

<span class="n">GPR_EXTERNAL</span><span class="w"> </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">gpr_drv_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="w">   </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_domains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">)</span><span class="o">/</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">ipc_dl_t</span><span class="p">);</span>

<span class="w">   </span><span class="n">rc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gpr_drv_internal_init</span><span class="p">(</span><span class="n">gpr_adsp_domain_ipc_dl_table</span><span class="p">,</span>
<span class="w">                              </span><span class="n">num_domains</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_IDS_DOMAIN_ID_ADSP_V</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_1</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_NUM_PACKETS_2</span><span class="p">,</span>
<span class="w">                              </span><span class="n">GPR_DRV_BYTES_PER_PACKET_2</span><span class="p">);</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rc</span><span class="w"> </span><span class="p">)</span>
<span class="w">   </span><span class="p">{</span>
<span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;Could not initialize the GPR infrastructure on ADSP&quot;</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="acronyms-and-terms">
<h2><a class="toc-backref" href="#id86" role="doc-backlink">Acronyms and Terms</a><a class="headerlink" href="#acronyms-and-terms" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Acronym or term</strong></p></th>
<th class="head"><p><strong>Definition</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>API</p></td>
<td><p>Application programming interface</p></td>
</tr>
<tr class="row-odd"><td><p>APPS</p></td>
<td><p>Applications</p></td>
</tr>
<tr class="row-even"><td><p>G-link</p></td>
<td><p>Generic link</p></td>
</tr>
<tr class="row-odd"><td><p>GPR</p></td>
<td><p>Generic Packet Router</p></td>
</tr>
<tr class="row-even"><td><p>GSL</p></td>
<td><p>Graph Service Layer</p></td>
</tr>
<tr class="row-odd"><td><p>GUID</p></td>
<td><p>Globally unique identifier</p></td>
</tr>
<tr class="row-even"><td><p>IPC</p></td>
<td><p>Interprocessor communication</p></td>
</tr>
<tr class="row-odd"><td><p>OSAL</p></td>
<td><p>Operating System Abstraction Layer</p></td>
</tr>
<tr class="row-even"><td><p>SMD</p></td>
<td><p>Shared Memory Driver</p></td>
</tr>
<tr class="row-odd"><td><p>ARE</p></td>
<td><p>AudioReach Engine</p></td>
</tr>
<tr class="row-even"><td><p>SPF</p></td>
<td><p>Signal Processing Framework</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="args_design.html" class="btn btn-neutral float-left" title="AudioReach Graph Services" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lx_design.html" class="btn btn-neutral float-right" title="Linux Adaptation Design" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, AudioReach.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>